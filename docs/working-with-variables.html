<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 Working with variables | Data Management for Clinical Researchers</title>
  <meta name="description" content="2 Working with variables | Data Management for Clinical Researchers" />
  <meta name="generator" content="bookdown 0.29 and GitBook 2.6.7" />

  <meta property="og:title" content="2 Working with variables | Data Management for Clinical Researchers" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 Working with variables | Data Management for Clinical Researchers" />
  
  
  

<meta name="author" content="Albert Cobos" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="working-with-dataframes.html"/>
<link rel="next" href="data-validation.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<link href="libs/str_view-0.1.0/str_view.css" rel="stylesheet" />
<script src="libs/str_view-binding-1.4.0/str_view.js"></script>
<script src="libs/font-awesome-5.13.0/js/script.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="working-with-dataframes.html"><a href="working-with-dataframes.html"><i class="fa fa-check"></i><b>1</b> Working with dataframes</a>
<ul>
<li class="chapter" data-level="1.1" data-path="working-with-dataframes.html"><a href="working-with-dataframes.html#subsetting-dataframes"><i class="fa fa-check"></i><b>1.1</b> Subsetting dataframes</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="working-with-dataframes.html"><a href="working-with-dataframes.html#subsetting-variables-columns"><i class="fa fa-check"></i><b>1.1.1</b> Subsetting variables (columns)</a></li>
<li class="chapter" data-level="1.1.2" data-path="working-with-dataframes.html"><a href="working-with-dataframes.html#subsetting-observations-rows"><i class="fa fa-check"></i><b>1.1.2</b> Subsetting observations (rows)</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="working-with-dataframes.html"><a href="working-with-dataframes.html#reshaping-dataframes"><i class="fa fa-check"></i><b>1.2</b> Reshaping dataframes</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="working-with-dataframes.html"><a href="working-with-dataframes.html#wide-to-long"><i class="fa fa-check"></i><b>1.2.1</b> Wide to long</a></li>
<li class="chapter" data-level="1.2.2" data-path="working-with-dataframes.html"><a href="working-with-dataframes.html#long-to-wide"><i class="fa fa-check"></i><b>1.2.2</b> Long to wide</a></li>
<li class="chapter" data-level="1.2.3" data-path="working-with-dataframes.html"><a href="working-with-dataframes.html#example"><i class="fa fa-check"></i><b>1.2.3</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="working-with-dataframes.html"><a href="working-with-dataframes.html#summarising-rows-of-a-dataframe"><i class="fa fa-check"></i><b>1.3</b> Summarising rows of a dataframe</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="working-with-dataframes.html"><a href="working-with-dataframes.html#summaries-in-grouped-data"><i class="fa fa-check"></i><b>1.3.1</b> Summaries in grouped data</a></li>
<li class="chapter" data-level="1.3.2" data-path="working-with-dataframes.html"><a href="working-with-dataframes.html#example-1"><i class="fa fa-check"></i><b>1.3.2</b> Example 1</a></li>
<li class="chapter" data-level="1.3.3" data-path="working-with-dataframes.html"><a href="working-with-dataframes.html#example-2"><i class="fa fa-check"></i><b>1.3.3</b> Example 2</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="working-with-dataframes.html"><a href="working-with-dataframes.html#combining-dataframes"><i class="fa fa-check"></i><b>1.4</b> Combining dataframes</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="working-with-dataframes.html"><a href="working-with-dataframes.html#joins"><i class="fa fa-check"></i><b>1.4.1</b> Joins</a></li>
<li class="chapter" data-level="1.4.2" data-path="working-with-dataframes.html"><a href="working-with-dataframes.html#example-1-left--and-right-joins"><i class="fa fa-check"></i><b>1.4.2</b> Example 1: left- and right-joins</a></li>
<li class="chapter" data-level="1.4.3" data-path="working-with-dataframes.html"><a href="working-with-dataframes.html#example-2-inner--and-full-joins"><i class="fa fa-check"></i><b>1.4.3</b> Example 2: inner- and full-joins</a></li>
<li class="chapter" data-level="1.4.4" data-path="working-with-dataframes.html"><a href="working-with-dataframes.html#binding"><i class="fa fa-check"></i><b>1.4.4</b> Binding</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="working-with-dataframes.html"><a href="working-with-dataframes.html#resources"><i class="fa fa-check"></i>Resources</a></li>
<li class="chapter" data-level="" data-path="working-with-dataframes.html"><a href="working-with-dataframes.html#exercises"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="working-with-variables.html"><a href="working-with-variables.html"><i class="fa fa-check"></i><b>2</b> Working with variables</a>
<ul>
<li class="chapter" data-level="2.1" data-path="working-with-variables.html"><a href="working-with-variables.html#strings"><i class="fa fa-check"></i><b>2.1</b> Strings</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="working-with-variables.html"><a href="working-with-variables.html#whitespaces-and-capitalization"><i class="fa fa-check"></i><b>2.1.1</b> Whitespaces and capitalization</a></li>
<li class="chapter" data-level="2.1.2" data-path="working-with-variables.html"><a href="working-with-variables.html#matching-locating-and-replacing-patterns"><i class="fa fa-check"></i><b>2.1.2</b> Matching, locating and replacing patterns</a></li>
<li class="chapter" data-level="2.1.3" data-path="working-with-variables.html"><a href="working-with-variables.html#regular-expressions"><i class="fa fa-check"></i><b>2.1.3</b> Regular expressions</a></li>
<li class="chapter" data-level="2.1.4" data-path="working-with-variables.html"><a href="working-with-variables.html#subsetting-strings"><i class="fa fa-check"></i><b>2.1.4</b> Subsetting strings</a></li>
<li class="chapter" data-level="2.1.5" data-path="working-with-variables.html"><a href="working-with-variables.html#other-useful-functions"><i class="fa fa-check"></i><b>2.1.5</b> Other useful functions</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="working-with-variables.html"><a href="working-with-variables.html#factors"><i class="fa fa-check"></i><b>2.2</b> Factors</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="working-with-variables.html"><a href="working-with-variables.html#reordering-levels"><i class="fa fa-check"></i><b>2.2.1</b> Reordering levels</a></li>
<li class="chapter" data-level="2.2.2" data-path="working-with-variables.html"><a href="working-with-variables.html#modifying-levels"><i class="fa fa-check"></i><b>2.2.2</b> Modifying levels</a></li>
<li class="chapter" data-level="2.2.3" data-path="working-with-variables.html"><a href="working-with-variables.html#ordered-factors"><i class="fa fa-check"></i><b>2.2.3</b> Ordered factors</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="working-with-variables.html"><a href="working-with-variables.html#dates"><i class="fa fa-check"></i><b>2.3</b> Dates</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="working-with-variables.html"><a href="working-with-variables.html#data-structures-for-date-and-date-time-values"><i class="fa fa-check"></i><b>2.3.1</b> Data structures for date and date-time values</a></li>
<li class="chapter" data-level="2.3.2" data-path="working-with-variables.html"><a href="working-with-variables.html#date-and-date-time-formats"><i class="fa fa-check"></i><b>2.3.2</b> Date and date-time formats</a></li>
<li class="chapter" data-level="2.3.3" data-path="working-with-variables.html"><a href="working-with-variables.html#reading-dates"><i class="fa fa-check"></i><b>2.3.3</b> Reading dates</a></li>
<li class="chapter" data-level="2.3.4" data-path="working-with-variables.html"><a href="working-with-variables.html#getting-date-components"><i class="fa fa-check"></i><b>2.3.4</b> Getting date components</a></li>
<li class="chapter" data-level="2.3.5" data-path="working-with-variables.html"><a href="working-with-variables.html#a-closer-look-to-dates"><i class="fa fa-check"></i><b>2.3.5</b> A closer look to dates</a></li>
<li class="chapter" data-level="2.3.6" data-path="working-with-variables.html"><a href="working-with-variables.html#shifting-dates"><i class="fa fa-check"></i><b>2.3.6</b> Shifting dates</a></li>
<li class="chapter" data-level="2.3.7" data-path="working-with-variables.html"><a href="working-with-variables.html#intervals"><i class="fa fa-check"></i><b>2.3.7</b> Intervals</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="working-with-variables.html"><a href="working-with-variables.html#dataframe-variables"><i class="fa fa-check"></i><b>2.4</b> Dataframe variables</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="working-with-variables.html"><a href="working-with-variables.html#processing-several-variables-at-once"><i class="fa fa-check"></i><b>2.4.1</b> Processing several variables at once</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="working-with-variables.html"><a href="working-with-variables.html#resources-1"><i class="fa fa-check"></i>Resources</a></li>
<li class="chapter" data-level="" data-path="working-with-variables.html"><a href="working-with-variables.html#exercises-1"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data-validation.html"><a href="data-validation.html"><i class="fa fa-check"></i><b>3</b> Data validation</a>
<ul>
<li class="chapter" data-level="3.1" data-path="data-validation.html"><a href="data-validation.html#variable-types"><i class="fa fa-check"></i><b>3.1</b> Variable types</a></li>
<li class="chapter" data-level="3.2" data-path="data-validation.html"><a href="data-validation.html#missings"><i class="fa fa-check"></i><b>3.2</b> Missings</a></li>
<li class="chapter" data-level="3.3" data-path="data-validation.html"><a href="data-validation.html#ranges"><i class="fa fa-check"></i><b>3.3</b> Ranges</a></li>
<li class="chapter" data-level="3.4" data-path="data-validation.html"><a href="data-validation.html#codelists"><i class="fa fa-check"></i><b>3.4</b> Codelists</a></li>
<li class="chapter" data-level="3.5" data-path="data-validation.html"><a href="data-validation.html#uniqueness"><i class="fa fa-check"></i><b>3.5</b> Uniqueness</a></li>
<li class="chapter" data-level="3.6" data-path="data-validation.html"><a href="data-validation.html#linear-sequences"><i class="fa fa-check"></i><b>3.6</b> Linear sequences</a></li>
<li class="chapter" data-level="3.7" data-path="data-validation.html"><a href="data-validation.html#availability-of-records"><i class="fa fa-check"></i><b>3.7</b> Availability of records</a></li>
<li class="chapter" data-level="3.8" data-path="data-validation.html"><a href="data-validation.html#multivariate-rules"><i class="fa fa-check"></i><b>3.8</b> Multivariate rules</a>
<ul>
<li class="chapter" data-level="3.8.1" data-path="data-validation.html"><a href="data-validation.html#inequalities"><i class="fa fa-check"></i><b>3.8.1</b> Inequalities</a></li>
<li class="chapter" data-level="3.8.2" data-path="data-validation.html"><a href="data-validation.html#conditional-restrictions"><i class="fa fa-check"></i><b>3.8.2</b> Conditional restrictions</a></li>
</ul></li>
<li class="chapter" data-level="3.9" data-path="data-validation.html"><a href="data-validation.html#rules-stored-in-files"><i class="fa fa-check"></i><b>3.9</b> Rules stored in files</a></li>
<li class="chapter" data-level="3.10" data-path="data-validation.html"><a href="data-validation.html#working-with-validator-objects"><i class="fa fa-check"></i><b>3.10</b> Working with validator objects</a></li>
<li class="chapter" data-level="3.11" data-path="data-validation.html"><a href="data-validation.html#designing-data-validation-plans-dvp"><i class="fa fa-check"></i><b>3.11</b> Designing data validation plans (DVP)</a></li>
<li class="chapter" data-level="" data-path="data-validation.html"><a href="data-validation.html#resources-2"><i class="fa fa-check"></i>Resources</a></li>
<li class="chapter" data-level="" data-path="data-validation.html"><a href="data-validation.html#exercises-2"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Data Management for Clinical Researchers</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="working-with-variables" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">2</span> Working with variables<a href="working-with-variables.html#working-with-variables" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In virtually all studies, the data preparation process involves computing new variables or modifying some of the existing ones. The operations needed to modify an existing variable, or to create a new one, are typically dependent on the type of the input variable(s). For instance, numerical variables (such as the body weight and height) may be used to compute another numeric variable (the body mass index) with some formula; factors (such as the study site in multicentric studies) are often used to create a new variable (such as region or country) using some classification algorithm; and character variables (like symptoms) may require homogenization tasks (such as capitalization or elimination of whitespaces). It is therefore important to know what are the tools available to work with different types of variables, and how to use them. In this chapter, we will see how to perform the most common operations on character vectors (or <em>strings</em>), factors and dates.</p>
<div id="strings" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Strings<a href="working-with-variables.html#strings" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Strings of characters are almost always found among the data collected in a clinical study. The description of symptoms, signs, diseases, adverse events and treatments are examples of textual data. These kind of data is often encoded using controlled vocabularies, like <a href="https://www.cdc.gov/nchs/icd/icd9.htm">ICD-9</a> or <a href="https://www.cdc.gov/nchs/icd/icd10.htm">ICD-10</a> for diseases, <a href="https://www.meddra.org/">MedDRA</a> for adverse events, or <a href="https://www.whocc.no/">ATC</a> for drugs. However, proper encoding using these vocabularies is a non-trivial task that requires a very good knowledge of the coding vocabulary, and it is not always affordable or cost-effective, particularly in small studies. In addition, there is not always a controlled vocabulary available for the textual data at hand. For these reasons, working with strings is a common need in clinical and other type of studies.</p>
<p>Although base R has functions to work with character vectors, we will give preference to those in package <code>stringr</code>, which is part of teh <code>tidyverse</code>. So, let’s start by loading this package:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="working-with-variables.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div>
<p><br />
</p>
<div id="whitespaces-and-capitalization" class="section level3 hasAnchor" number="2.1.1">
<h3><span class="header-section-number">2.1.1</span> Whitespaces and capitalization<a href="working-with-variables.html#whitespaces-and-capitalization" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>When working with real data, we will often find character vectors having semantically equivalent, but nonetheless <em>different</em> elements, due to whitespaces and capitalization. Consider the following character vector:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="working-with-variables.html#cb2-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Arterial hypertension&quot;</span>, <span class="st">&quot;arterial hypertension&quot;</span>, <span class="st">&quot;ARTERIAL HYPERTENSION&quot;</span>,</span>
<span id="cb2-2"><a href="working-with-variables.html#cb2-2" aria-hidden="true" tabindex="-1"></a>       <span class="st">&quot;arterial   hypertension &quot;</span>, <span class="st">&quot;arterial hypertension &quot;</span>,  <span class="st">&quot;Pneumonia&quot;</span>, </span>
<span id="cb2-3"><a href="working-with-variables.html#cb2-3" aria-hidden="true" tabindex="-1"></a>       <span class="st">&quot;pneumonia&quot;</span>, <span class="st">&quot; pneumonia&quot;</span>)</span>
<span id="cb2-4"><a href="working-with-variables.html#cb2-4" aria-hidden="true" tabindex="-1"></a>x</span></code></pre></div>
<pre><code>## [1] &quot;Arterial hypertension&quot;    &quot;arterial hypertension&quot;   
## [3] &quot;ARTERIAL HYPERTENSION&quot;    &quot;arterial   hypertension &quot;
## [5] &quot;arterial hypertension &quot;   &quot;Pneumonia&quot;               
## [7] &quot;pneumonia&quot;                &quot; pneumonia&quot;</code></pre>
<p><br />
</p>
<p>Although only two conditions appear in <code>x</code> (arterial hypertension and pneumonia), a frequency table of this vector will be less than satisfying, because all elements are actually different: some are lowercase, others contain uppercase letters, and some contain extra whitespaces (at the beginning, at the end, or between words):</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="working-with-variables.html#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(x) <span class="sc">%&gt;%</span> <span class="fu">count</span>(x)</span></code></pre></div>
<pre><code>##                          x n
## 1                pneumonia 1
## 2 arterial   hypertension  1
## 3    arterial hypertension 1
## 4    Arterial hypertension 1
## 5    ARTERIAL HYPERTENSION 1
## 6   arterial hypertension  1
## 7                pneumonia 1
## 8                Pneumonia 1</code></pre>
<p><br />
</p>
<p>Because R is case sensitive, <code>"Arterial hypertension"</code> is not the same as <code>"arterial hypertension"</code>. In addition, it is important to be aware that a white space (or <em>blank</em>) is a character in its own right, and therefore these two strings are different because of a trailing blank in the second one:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="working-with-variables.html#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;arterial hypertension&quot;</span> <span class="sc">==</span> <span class="st">&quot;arterial hypertension &quot;</span></span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<p><br />
</p>
<p>Function <code>str_trim()</code> removes white spaces at the beginning or at the end of a string:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="working-with-variables.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_trim</span>(x) </span></code></pre></div>
<pre><code>## [1] &quot;Arterial hypertension&quot;   &quot;arterial hypertension&quot;  
## [3] &quot;ARTERIAL HYPERTENSION&quot;   &quot;arterial   hypertension&quot;
## [5] &quot;arterial hypertension&quot;   &quot;Pneumonia&quot;              
## [7] &quot;pneumonia&quot;               &quot;pneumonia&quot;</code></pre>
<p><br />
</p>
<p>In the result above, elements two and four of <code>x</code> are still different, because the later has more than one white space between the two words. Function <code>str_squish()</code> not only removes leading and trailing white spaces, but also reduces repeated white spaces inside a string:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="working-with-variables.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_squish</span>(x)</span></code></pre></div>
<pre><code>## [1] &quot;Arterial hypertension&quot; &quot;arterial hypertension&quot; &quot;ARTERIAL HYPERTENSION&quot;
## [4] &quot;arterial hypertension&quot; &quot;arterial hypertension&quot; &quot;Pneumonia&quot;            
## [7] &quot;pneumonia&quot;             &quot;pneumonia&quot;</code></pre>
<p><br />
</p>
<p>After getting rid of white spaces, we can use any of the following functions to homogenize case: <code>str_to_lower()</code>, <code>str_to_upper()</code>, <code>str_to_title()</code> or <code>str_to_sentence()</code>. Here we use the last one (but you can try with the other three):</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="working-with-variables.html#cb12-1" aria-hidden="true" tabindex="-1"></a>x <span class="sc">%&gt;%</span> </span>
<span id="cb12-2"><a href="working-with-variables.html#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_squish</span>() <span class="sc">%&gt;%</span>                  <span class="co"># removes leading, trailing and repeated blanks</span></span>
<span id="cb12-3"><a href="working-with-variables.html#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_to_sentence</span>()                 <span class="co"># capitalizes the first letter</span></span></code></pre></div>
<pre><code>## [1] &quot;Arterial hypertension&quot; &quot;Arterial hypertension&quot; &quot;Arterial hypertension&quot;
## [4] &quot;Arterial hypertension&quot; &quot;Arterial hypertension&quot; &quot;Pneumonia&quot;            
## [7] &quot;Pneumonia&quot;             &quot;Pneumonia&quot;</code></pre>
<p><br />
The two conditions appearing in <code>x</code> have now a homogeneous spelling, so that a decent frequency table can be produced, as shown below.</p>
<p>In the scripts above we started working with an isolated character vector (<code>x</code>) . But what if this is a variable in a dataframe? The same functions can be used (and chained!) within a mutate statement to compute a new version of <code>x</code>:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="working-with-variables.html#cb14-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(x)</span>
<span id="cb14-2"><a href="working-with-variables.html#cb14-2" aria-hidden="true" tabindex="-1"></a>d</span></code></pre></div>
<pre><code>##                          x
## 1    Arterial hypertension
## 2    arterial hypertension
## 3    ARTERIAL HYPERTENSION
## 4 arterial   hypertension 
## 5   arterial hypertension 
## 6                Pneumonia
## 7                pneumonia
## 8                pneumonia</code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="working-with-variables.html#cb16-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb16-2"><a href="working-with-variables.html#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">x =</span> x <span class="sc">%&gt;%</span> </span>
<span id="cb16-3"><a href="working-with-variables.html#cb16-3" aria-hidden="true" tabindex="-1"></a>           <span class="fu">str_squish</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb16-4"><a href="working-with-variables.html#cb16-4" aria-hidden="true" tabindex="-1"></a>           <span class="fu">str_to_sentence</span>()) <span class="sc">%&gt;%</span>  </span>
<span id="cb16-5"><a href="working-with-variables.html#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(x)                                <span class="co"># frequency table of x values</span></span></code></pre></div>
<pre><code>##                       x n
## 1 Arterial hypertension 5
## 2             Pneumonia 3</code></pre>
<p><br />
</p>
<p>Now the frequency table looks as it should.</p>
</div>
<div id="matching-locating-and-replacing-patterns" class="section level3 hasAnchor" number="2.1.2">
<h3><span class="header-section-number">2.1.2</span> Matching, locating and replacing patterns<a href="working-with-variables.html#matching-locating-and-replacing-patterns" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Sometimes we will need to match some defined <em>pattern</em> in a character vector, with any of these purposes:</p>
<ul>
<li><p><em>Detect</em> which elements in the vector match the pattern.</p></li>
<li><p><em>Locate</em> the position at which the pattern occurs in each element of the vector.</p></li>
<li><p><em>Replace</em> the pattern with an alternative text.</p></li>
<li><p><em>Count</em> how many times a pattern appears in each element of the vector.</p></li>
</ul>
<p>Functions <code>str_detect()</code>, <code>str_locate()</code>, <code>str_replace()</code>, and <code>str_count()</code> serve these four purposes, respectively. In all three functions, a <code>pattern</code> argument has to be specified.</p>
<p>Consider the following vector describing the medical antecedents of 3 patients:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="working-with-variables.html#cb18-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;diabetes mellitus&quot;</span>,  <span class="st">&quot;asthma&quot;</span>, <span class="st">&quot;bronchial asthma + DM.&quot;</span>)</span>
<span id="cb18-2"><a href="working-with-variables.html#cb18-2" aria-hidden="true" tabindex="-1"></a>x</span></code></pre></div>
<pre><code>## [1] &quot;diabetes mellitus&quot;      &quot;asthma&quot;                 &quot;bronchial asthma + DM.&quot;</code></pre>
<p><br />
</p>
<p>Suppose we want to identify patients with bronchial asthma. Patients 2 and 3 have different descriptors, but both contain “asthma”. Function <code>str_detect()</code> will tell us which elements in <code>x</code> contain “asthma”, by returning a logical vector the same length of <code>x</code>, with <code>TRUE</code> when the <code>pattern</code> is detected or <code>FALSE</code> otherwise:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="working-with-variables.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(x, <span class="at">pattern =</span> <span class="st">&quot;asthma&quot;</span>)</span></code></pre></div>
<pre><code>## [1] FALSE  TRUE  TRUE</code></pre>
<p><br />
</p>
<p>In some cases we may need to know what are the <em>positions</em> where a pattern is found. This can be achieved with function <code>str_locate()</code>. Note the result is a <em>matrix</em> with as many rows as elements in <code>x</code>, and two columns indicating the <code>start</code>-ing and <code>end</code>-ing positions of the pattern (or <code>NA</code> for non-matching elements in <code>x</code>).</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="working-with-variables.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_locate</span>(x, <span class="st">&quot;asthma&quot;</span>)</span></code></pre></div>
<pre><code>##      start end
## [1,]    NA  NA
## [2,]     1   6
## [3,]    11  16</code></pre>
<p><br />
</p>
<p>Now suppose we want to replace “DM” by the full description “diabetes mellitus”. This can be done with <code>str_replace()</code>, specifying the <code>pattern</code> to be replaced and the <code>replacement</code> text:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="working-with-variables.html#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_replace</span>(x, <span class="at">pattern =</span> <span class="st">&quot;DM&quot;</span>, <span class="at">replacement =</span> <span class="st">&quot;diabetes mellitus&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;diabetes mellitus&quot;                    
## [2] &quot;asthma&quot;                               
## [3] &quot;bronchial asthma + diabetes mellitus.&quot;</code></pre>
<p><br />
</p>
<p>Last, <code>str_count()</code>counts the number of appearances of the <code>pattern</code> in each element of the input vector:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="working-with-variables.html#cb26-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;I&quot;</span>, <span class="st">&quot;II&quot;</span>, <span class="st">&quot;III.&quot;</span>, <span class="st">&quot;IV&quot;</span>)</span>
<span id="cb26-2"><a href="working-with-variables.html#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_count</span>(x, <span class="at">pattern =</span> <span class="st">&quot;I&quot;</span>)</span></code></pre></div>
<pre><code>## [1] 1 2 3 1</code></pre>
<p><br />
</p>
<p>The previous examples worked because the specified patterns contain letters only. However, when the pattern contains special characters, such as the dot, this will produce an error or unexpected results, as in this case:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="working-with-variables.html#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(x, <span class="at">pattern =</span> <span class="st">&quot;.&quot;</span>)</span></code></pre></div>
<pre><code>## [1] TRUE TRUE TRUE TRUE</code></pre>
<p><br />
</p>
<p>The reason for the previous result is that, by default, <code>str_detect()</code> expects the pattern to be specified as a <em>regular expression</em>. Regular expression are introduced in the next section, but for the time being, a turnaround is to use the helper function <code>fixed()</code> to specify the pattern <em>literally</em> (or <code>coll()</code> for languages other than English, see <code>?fixed</code>). Now the result is as expected:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="working-with-variables.html#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(x, <span class="at">pattern =</span> <span class="fu">fixed</span>(<span class="st">&quot;.&quot;</span>))           </span></code></pre></div>
<pre><code>## [1] FALSE FALSE  TRUE FALSE</code></pre>
<p><br />
</p>
</div>
<div id="regular-expressions" class="section level3 hasAnchor" number="2.1.3">
<h3><span class="header-section-number">2.1.3</span> Regular expressions<a href="working-with-variables.html#regular-expressions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Regular expressions (shortened as <em>regex</em> or <em>regexp</em>) provide a very flexible and concise way to specify complex patterns in strings through the use of symbols with special meaning called <em>meta characters</em>. These are listed in table <a href="working-with-variables.html#tab:2-regex-meta-characters">2.1</a> and examples of use follow.</p>
<table>
<caption><span id="tab:2-regex-meta-characters">Table 2.1: </span> Meta characters used in regular expressions</caption>
<thead>
<tr class="header">
<th>Meta character</th>
<th align="left">Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>.</td>
<td align="left">Matches any single character, except a line break</td>
</tr>
<tr class="even">
<td>|</td>
<td align="left">Matches the previous or the next characters</td>
</tr>
<tr class="odd">
<td>^</td>
<td align="left">Denotes the begining of the string</td>
</tr>
<tr class="even">
<td>$</td>
<td align="left">Denotes the end of the string</td>
</tr>
<tr class="odd">
<td>[ ]</td>
<td align="left">Matches any character contained between them</td>
</tr>
<tr class="even">
<td>[^ ]</td>
<td align="left">Matches any character NOT contained between them</td>
</tr>
<tr class="odd">
<td>( )</td>
<td align="left">Matches the characters contained between them in exact order</td>
</tr>
<tr class="even">
<td>?</td>
<td align="left">Makes the preceeding optional</td>
</tr>
<tr class="odd">
<td>*</td>
<td align="left">Matches 0 or more repetitions of the preceeding</td>
</tr>
<tr class="even">
<td>+</td>
<td align="left">Matches 1 or more repetitions of the preceeding</td>
</tr>
<tr class="odd">
<td>{n}</td>
<td align="left">Matches exactly n repetitions of the preceeding</td>
</tr>
<tr class="even">
<td>{n,m}</td>
<td align="left">Matches a minimum of “n” and a maximum of “m” repetitions of the preceding</td>
</tr>
<tr class="odd">
<td>\</td>
<td align="left">Escapes the next character</td>
</tr>
</tbody>
</table>
<p><br />
</p>
<p>The period <code>.</code> is used as a <em>wildcard</em>. Here we use it to match not only <code>"diabetes"</code>, but also the misspelled <code>"diabetis"</code>:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="working-with-variables.html#cb32-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;diabetes mellitus&quot;</span>, <span class="st">&quot;diabetis&quot;</span>, <span class="st">&quot;DM&quot;</span>, <span class="st">&quot;non-diabetic&quot;</span>, <span class="st">&quot;carotid stenosis&quot;</span>)</span>
<span id="cb32-2"><a href="working-with-variables.html#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(x, <span class="at">pattern =</span> <span class="st">&quot;diabet.s&quot;</span>)</span></code></pre></div>
<pre><code>## [1]  TRUE  TRUE FALSE FALSE FALSE</code></pre>
<p><br />
</p>
<p>The vertical bar <code>|</code> is used to specify alternative patterns (read it as <em>or</em>) to be matched. Here we use it to match “diabet.s” or the abbreviation for diabetes mellitus, “DM”:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="working-with-variables.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(x, <span class="at">pattern =</span> <span class="st">&quot;diabet.s|DM&quot;</span>)</span></code></pre></div>
<pre><code>## [1]  TRUE  TRUE  TRUE FALSE FALSE</code></pre>
<p><br />
</p>
<p>The caret <code>^</code> and the dollar <code>$</code> are used as <em>anchors</em>, to indicate the begining and the end of the string, respectively. Here we use them to identify drug families (cephalosporins and monoclonal antibodies):</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="working-with-variables.html#cb36-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;cefaclor&quot;</span>, <span class="st">&quot;cefixime&quot;</span>, <span class="st">&quot;diphenhydramine acefyllinate&quot;</span>)</span>
<span id="cb36-2"><a href="working-with-variables.html#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(x, <span class="at">pattern =</span> <span class="st">&quot;^cef&quot;</span>)</span></code></pre></div>
<pre><code>## [1]  TRUE  TRUE FALSE</code></pre>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="working-with-variables.html#cb38-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;omalizumab&quot;</span>, <span class="st">&quot;reslizumab&quot;</span>, <span class="st">&quot;mabuterol&quot;</span>)</span>
<span id="cb38-2"><a href="working-with-variables.html#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(x, <span class="at">pattern =</span> <span class="st">&quot;mab$&quot;</span>)</span></code></pre></div>
<pre><code>## [1]  TRUE  TRUE FALSE</code></pre>
<p><br />
</p>
<p>Square brackets <code>[]</code> are used to specify a <em>class</em> of characters, so that <em>any</em> character in the class will be matched. Classes can be specified by a sequence of characters, as in <code>[abc]</code>, <code>[ABC]</code> or <code>[123]</code>, or using the dash to indicate a range, as in <code>[a-z]</code>, <code>[A-Z]</code>, or <code>[0-9]</code>.</p>
<p>In the following example we use function <code>str_extract()</code> to get the doses and units from character vector <code>x</code>. The <code>+</code> is a <em>quantifier</em>, indicating to pick the pevious <em>one or more times</em> (try without the <code>+</code> to see the difference):</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="working-with-variables.html#cb40-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;250 mg&quot;</span>, <span class="st">&quot;500mg&quot;</span>, <span class="st">&quot;1 g&quot;</span>, <span class="st">&quot;1gram&quot;</span>, <span class="st">&quot;250 MG&quot;</span>)</span>
<span id="cb40-2"><a href="working-with-variables.html#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_extract</span>(x, <span class="at">pattern =</span> <span class="st">&quot;[0-9]+&quot;</span>)           <span class="co"># any number</span></span></code></pre></div>
<pre><code>## [1] &quot;250&quot; &quot;500&quot; &quot;1&quot;   &quot;1&quot;   &quot;250&quot;</code></pre>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="working-with-variables.html#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_extract</span>(x, <span class="at">pattern =</span> <span class="st">&quot;[a-zA-Z]+&quot;</span>)        <span class="co"># any alphabetic character</span></span></code></pre></div>
<pre><code>## [1] &quot;mg&quot;   &quot;mg&quot;   &quot;g&quot;    &quot;gram&quot; &quot;MG&quot;</code></pre>
<p> </p>
<p>Some classes of characters are so common that they are given special names:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="working-with-variables.html#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_extract</span>(x, <span class="at">pattern =</span> <span class="st">&quot;[:digit:]+&quot;</span>)       <span class="co"># same as &quot;[0-9]+&quot;</span></span></code></pre></div>
<pre><code>## [1] &quot;250&quot; &quot;500&quot; &quot;1&quot;   &quot;1&quot;   &quot;250&quot;</code></pre>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="working-with-variables.html#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_extract</span>(x, <span class="at">pattern =</span> <span class="st">&quot;[:alpha:]+&quot;</span>)       <span class="co"># same as &quot;[a-zA-Z]+&quot;</span></span></code></pre></div>
<pre><code>## [1] &quot;mg&quot;   &quot;mg&quot;   &quot;g&quot;    &quot;gram&quot; &quot;MG&quot;</code></pre>
<p><br />
</p>
<p>When the caret <code>^</code> is used within <code>[]</code>, it means negation, that is, to match any character <em>not</em> in the specified class. For instance, in the following script, we first extract roman numerals I to IV from vector <code>nyha</code>, and then we extract anything which is not one of them:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="working-with-variables.html#cb48-1" aria-hidden="true" tabindex="-1"></a>nyha <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;I. No limitation in normal physical activity&quot;</span>, </span>
<span id="cb48-2"><a href="working-with-variables.html#cb48-2" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;II. Mild symptoms only in normal activity&quot;</span>, </span>
<span id="cb48-3"><a href="working-with-variables.html#cb48-3" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;III. Marked symptoms during daily activities, asymptomatic only at rest&quot;</span>, </span>
<span id="cb48-4"><a href="working-with-variables.html#cb48-4" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;IV. Severe limitations, symptoms even at rest&quot;</span>)</span>
<span id="cb48-5"><a href="working-with-variables.html#cb48-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-6"><a href="working-with-variables.html#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="fu">str_extract</span>(nyha, <span class="at">pattern =</span> <span class="st">&quot;[IV]+&quot;</span>)          <span class="co"># any I or V</span></span></code></pre></div>
<pre><code>## [1] &quot;I&quot;   &quot;II&quot;  &quot;III&quot; &quot;IV&quot;</code></pre>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="working-with-variables.html#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_extract</span>(nyha, <span class="at">pattern =</span> <span class="st">&quot;[^IV]+&quot;</span>)         <span class="co"># anything different from I and V</span></span></code></pre></div>
<pre><code>## [1] &quot;. No limitation in normal physical activity&quot;                         
## [2] &quot;. Mild symptoms only in normal activity&quot;                             
## [3] &quot;. Marked symptoms during daily activities, asymptomatic only at rest&quot;
## [4] &quot;. Severe limitations, symptoms even at rest&quot;</code></pre>
<p><br />
</p>
<p>Brackets <code>()</code> are used to define a group of characters <em>in the specified sequence</em>. For instance, suppose we want to extract the units from vector <code>x</code>. Note the difference with square brackets:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="working-with-variables.html#cb52-1" aria-hidden="true" tabindex="-1"></a>x</span></code></pre></div>
<pre><code>## [1] &quot;250 mg&quot; &quot;500mg&quot;  &quot;1 g&quot;    &quot;1gram&quot;  &quot;250 MG&quot;</code></pre>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="working-with-variables.html#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(x, <span class="at">pattern =</span> <span class="st">&quot;[mg]&quot;</span>)        <span class="co"># match any m or g, lowercase</span></span></code></pre></div>
<pre><code>## [1]  TRUE  TRUE  TRUE  TRUE FALSE</code></pre>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="working-with-variables.html#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(x, <span class="at">pattern =</span> <span class="st">&quot;(mg)&quot;</span>)        <span class="co"># match the sequence &quot;mg&quot;</span></span></code></pre></div>
<pre><code>## [1]  TRUE  TRUE FALSE FALSE FALSE</code></pre>
<p><br />
</p>
<p>The question mark <code>?</code> is used to make the preceeding optional. Here we use it to match two alternative spellings of some words:</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="working-with-variables.html#cb58-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;haemorrhage&quot;</span>, <span class="st">&quot;hemorrhage&quot;</span>, <span class="st">&quot;hemoglobin decreased&quot;</span>, <span class="st">&quot;haemoglobin decreased&quot;</span>)</span>
<span id="cb58-2"><a href="working-with-variables.html#cb58-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-3"><a href="working-with-variables.html#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(x, <span class="at">pattern =</span> <span class="st">&quot;ha?emo&quot;</span>)</span></code></pre></div>
<pre><code>## [1] TRUE TRUE TRUE TRUE</code></pre>
<p><br />
Braces <code>{}</code> are used to define number of repetitions, either exact, or in an interval:</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="working-with-variables.html#cb60-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;AMI in 2019&quot;</span>, <span class="st">&quot;Born in 1989&quot;</span>, <span class="st">&quot;Pulse 75 bpm&quot;</span>)</span>
<span id="cb60-2"><a href="working-with-variables.html#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_extract</span>(x, <span class="at">pattern=</span><span class="st">&quot;[0-9]{4}&quot;</span>)                   <span class="co"># exactly four digits</span></span></code></pre></div>
<pre><code>## [1] &quot;2019&quot; &quot;1989&quot; NA</code></pre>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="working-with-variables.html#cb62-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;500 mg/24h&quot;</span>, <span class="st">&quot;1000 mg/24h&quot;</span>, <span class="st">&quot;week 1: 750 mg daily&quot;</span>)</span>
<span id="cb62-2"><a href="working-with-variables.html#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_extract</span>(x, <span class="at">pattern=</span><span class="st">&quot;[0-9]{3,4}&quot;</span>)                 <span class="co"># between three and four digits</span></span></code></pre></div>
<pre><code>## [1] &quot;500&quot;  &quot;1000&quot; &quot;750&quot;</code></pre>
<p><br />
</p>
<p>The asterisk <code>*</code> allows to match any number of repetitions of an optional part:</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="working-with-variables.html#cb64-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;ab&quot;</span>, <span class="st">&quot;aab&quot;</span>, <span class="st">&quot;aaaab&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>)</span>
<span id="cb64-2"><a href="working-with-variables.html#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(x, <span class="at">pattern=</span><span class="st">&quot;a*b&quot;</span>)</span></code></pre></div>
<pre><code>## [1]  TRUE  TRUE  TRUE  TRUE FALSE</code></pre>
<p><br />
</p>
<p>Last, the backslash (<code>\</code>) allows to remove the special meaning of meta characters, when we need to match them literally. However, because the backslash is a meta character itself, we need to remove its special meaning with another backslash, so that wee need to write two of them:</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="working-with-variables.html#cb66-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;asthma&quot;</span>, <span class="st">&quot;astha + DM&quot;</span>, <span class="st">&quot;AHT + hyperlipidemia&quot;</span>)</span>
<span id="cb66-2"><a href="working-with-variables.html#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(x, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">+&quot;</span>)</span></code></pre></div>
<pre><code>## [1] FALSE  TRUE  TRUE</code></pre>
<p><br />
</p>
<p>Working with regular expressions is challenging, particularly as they increase in complexity, and a useful trick is to <em>visualize</em> the matches they produce. A couple of functions help with this: <code>str_view()</code> shows the first match, and <code>str_view_all()</code> shows all matches:</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="working-with-variables.html#cb68-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;haemorrhage&quot;</span>, <span class="st">&quot;hemorrhage and hemoglobin decreased&quot;</span>, <span class="st">&quot;haemoglobin decreased&quot;</span>)</span>
<span id="cb68-2"><a href="working-with-variables.html#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(x, <span class="at">pattern =</span> <span class="st">&quot;ha?emo&quot;</span>)</span></code></pre></div>
<div id="htmlwidget-8db3f31f6d015672a508" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-8db3f31f6d015672a508">{"x":{"html":"<ul>\n  <li><span class='match'>haemo<\/span>rrhage<\/li>\n  <li><span class='match'>hemo<\/span>rrhage and hemoglobin decreased<\/li>\n  <li><span class='match'>haemo<\/span>globin decreased<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="working-with-variables.html#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view_all</span>(x, <span class="at">pattern =</span> <span class="st">&quot;ha?emo&quot;</span>)</span></code></pre></div>
<div id="htmlwidget-51a2181c21be7771c412" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-51a2181c21be7771c412">{"x":{"html":"<ul>\n  <li><span class='match'>haemo<\/span>rrhage<\/li>\n  <li><span class='match'>hemo<\/span>rrhage and <span class='match'>hemo<\/span>globin decreased<\/li>\n  <li><span class='match'>haemo<\/span>globin decreased<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
</div>
<div id="subsetting-strings" class="section level3 hasAnchor" number="2.1.4">
<h3><span class="header-section-number">2.1.4</span> Subsetting strings<a href="working-with-variables.html#subsetting-strings" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>When we need to extract a specific part of a string defined by its position, function <code>str_sub()</code> is the way to go. Consider for instance the CIP codes, the unique personal identifier used by the Catalan Healthcare System, composed by 14 characters with the following structure: “iiiisyymmddxxx”, where “iiii” are surname initials, “s” is a code for sex (0: men, 1:female), “yymmdd” is the birth date, and “xxx” are three random numbers.</p>
<p>Here we extract different parts of the CIP code based on <code>start</code> and <code>end</code> positions:</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="working-with-variables.html#cb70-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;FEGA0720525000&quot;</span>, <span class="st">&quot;ROMA1680913000&quot;</span>, <span class="st">&quot;PEJI0590503&quot;</span>)</span>
<span id="cb70-2"><a href="working-with-variables.html#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_sub</span>(x, <span class="at">start =</span> <span class="dv">5</span>, <span class="at">end =</span> <span class="dv">5</span>)          <span class="co"># extracts sex code</span></span></code></pre></div>
<pre><code>## [1] &quot;0&quot; &quot;1&quot; &quot;0&quot;</code></pre>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="working-with-variables.html#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_sub</span>(x, <span class="at">start =</span> <span class="dv">6</span>, <span class="at">end =</span> <span class="dv">7</span>)          <span class="co"># extracts year of birth</span></span></code></pre></div>
<pre><code>## [1] &quot;72&quot; &quot;68&quot; &quot;59&quot;</code></pre>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="working-with-variables.html#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_sub</span>(x, <span class="at">start =</span> <span class="dv">6</span>, <span class="at">end =</span> <span class="dv">11</span>)         <span class="co"># extracts birthdate</span></span></code></pre></div>
<pre><code>## [1] &quot;720525&quot; &quot;680913&quot; &quot;590503&quot;</code></pre>
</div>
<div id="other-useful-functions" class="section level3 hasAnchor" number="2.1.5">
<h3><span class="header-section-number">2.1.5</span> Other useful functions<a href="working-with-variables.html#other-useful-functions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Function <code>str_length()</code> finds the number of characters for each element of the input vector:</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="working-with-variables.html#cb76-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;DM&quot;</span>, <span class="st">&quot;AHT&quot;</span>)</span>
<span id="cb76-2"><a href="working-with-variables.html#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_length</span>(x)</span></code></pre></div>
<pre><code>## [1] 2 3</code></pre>
<p><br />
</p>
<p>Sometimes we may want to collapse all the elements of a character vector into a single string (a character vector of length one). This can be done with <code>str_flatten()</code>:</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="working-with-variables.html#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_flatten</span>(x, <span class="at">collapse =</span> <span class="st">&quot; and &quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;DM and AHT&quot;</code></pre>
<p><br />
</p>
<p>With <code>str_glue()</code> we can easily compose texts, inserting values as needed, which may be useful to produce narrative reports. Note the use of <code>str_flatten()</code> to define <code>antecedents</code>:</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="working-with-variables.html#cb80-1" aria-hidden="true" tabindex="-1"></a>pid <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb80-2"><a href="working-with-variables.html#cb80-2" aria-hidden="true" tabindex="-1"></a>age <span class="ot">&lt;-</span> <span class="dv">58</span></span>
<span id="cb80-3"><a href="working-with-variables.html#cb80-3" aria-hidden="true" tabindex="-1"></a>sex <span class="ot">&lt;-</span> <span class="st">&quot;male&quot;</span></span>
<span id="cb80-4"><a href="working-with-variables.html#cb80-4" aria-hidden="true" tabindex="-1"></a>antecedents <span class="ot">&lt;-</span> <span class="fu">str_flatten</span>(x, <span class="at">collapse =</span> <span class="st">&quot; and &quot;</span>)</span>
<span id="cb80-5"><a href="working-with-variables.html#cb80-5" aria-hidden="true" tabindex="-1"></a>adverse_event <span class="ot">&lt;-</span> <span class="st">&quot;cephalea&quot;</span></span>
<span id="cb80-6"><a href="working-with-variables.html#cb80-6" aria-hidden="true" tabindex="-1"></a>study_day <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb80-7"><a href="working-with-variables.html#cb80-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-8"><a href="working-with-variables.html#cb80-8" aria-hidden="true" tabindex="-1"></a><span class="fu">str_glue</span>(<span class="st">&quot;Patient number {pid}, a {age}y {sex} with {antecedents},</span></span>
<span id="cb80-9"><a href="working-with-variables.html#cb80-9" aria-hidden="true" tabindex="-1"></a><span class="st">         reported {adverse_event} on study day {study_day}.&quot;</span>)</span></code></pre></div>
<pre><code>## Patient number 10, a 58y male with DM and AHT,
## reported cephalea on study day 3.</code></pre>
<p><br />
</p>
<p>Function <code>str_split()</code> splits up a string into pieces by defining a <code>pattern</code> used as separator, and returns a list the same length of the input vector. In the following example we split antecedents of a patient separated by a <code>+</code>. We need to use the (double) backslash in <code>pattern</code> to refer to literal <code>+</code>, and not to meta character <code>+</code>:</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="working-with-variables.html#cb82-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;asthma&quot;</span>, <span class="st">&quot;astha + DM&quot;</span>, <span class="st">&quot;DM + AHT + hyperlipidemia&quot;</span>)</span>
<span id="cb82-2"><a href="working-with-variables.html#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_split</span>(x, <span class="at">pattern =</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">+&quot;</span>)</span></code></pre></div>
<pre><code>## [[1]]
## [1] &quot;asthma&quot;
## 
## [[2]]
## [1] &quot;astha &quot; &quot; DM&quot;   
## 
## [[3]]
## [1] &quot;DM &quot;             &quot; AHT &quot;           &quot; hyperlipidemia&quot;</code></pre>
<p><br />
</p>
<p>The result is a list of character vectors, each having as many elements as antecedents. We can use the option <code>simplify = TRUE</code> to get the result as a matrix instead, with as many rows as elements in the input vector, and as many columns as the maximum number of antecedents, three in this example. In this case, some entries will be empty for patients with less than three antecedents:</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="working-with-variables.html#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_split</span>(x, <span class="at">pattern =</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">+&quot;</span>, <span class="at">simplify =</span> <span class="cn">TRUE</span>) </span></code></pre></div>
<pre><code>##      [,1]     [,2]    [,3]             
## [1,] &quot;asthma&quot; &quot;&quot;      &quot;&quot;               
## [2,] &quot;astha &quot; &quot; DM&quot;   &quot;&quot;               
## [3,] &quot;DM &quot;    &quot; AHT &quot; &quot; hyperlipidemia&quot;</code></pre>
<p><br />
</p>
<p>Function <code>str_sort()</code> will sort the elements of a character vector alphabetically, unless we use option <code>numeric=TRUE</code>:</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="working-with-variables.html#cb86-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;10 mg&quot;</span>, <span class="st">&quot;5 mg&quot;</span>, <span class="st">&quot;2.5 mg&quot;</span>)</span>
<span id="cb86-2"><a href="working-with-variables.html#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_sort</span>(x, <span class="at">numeric =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2.5 mg&quot; &quot;5 mg&quot;   &quot;10 mg&quot;</code></pre>
</div>
</div>
<div id="factors" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> Factors<a href="working-with-variables.html#factors" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Package <code>forcats</code>, which is part of the <code>tidyverse</code>, has functions to address common needs when working with factors. To illustrate some of these functions we will use the DISETHAE data introduced in the previous chapter. Here we read the data and define a factor for the categorical variable <code>region</code>:</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="working-with-variables.html#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb88-2"><a href="working-with-variables.html#cb88-2" aria-hidden="true" tabindex="-1"></a>ah <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">&quot;./data/hta.xlsx&quot;</span>, <span class="at">sheet =</span> <span class="st">&quot;data&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb88-3"><a href="working-with-variables.html#cb88-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">region =</span> <span class="fu">factor</span>(region, </span>
<span id="cb88-4"><a href="working-with-variables.html#cb88-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">17</span>, </span>
<span id="cb88-5"><a href="working-with-variables.html#cb88-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Andalucía&quot;</span>, <span class="st">&quot;Aragón&quot;</span>, <span class="st">&quot;Asturias&quot;</span>,</span>
<span id="cb88-6"><a href="working-with-variables.html#cb88-6" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">&quot;Baleares&quot;</span>, <span class="st">&quot;Canarias&quot;</span>, <span class="st">&quot;Cantabria&quot;</span>,</span>
<span id="cb88-7"><a href="working-with-variables.html#cb88-7" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">&quot;Castilla-La Mancha&quot;</span>, <span class="st">&quot;Castilla-León&quot;</span>,</span>
<span id="cb88-8"><a href="working-with-variables.html#cb88-8" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">&quot;Catalunya&quot;</span>, <span class="st">&quot;Extremadura&quot;</span>, <span class="st">&quot;Galicia&quot;</span>, </span>
<span id="cb88-9"><a href="working-with-variables.html#cb88-9" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">&quot;La Rioja&quot;</span>, <span class="st">&quot;Madrid&quot;</span>, <span class="st">&quot;Murcia&quot;</span>, <span class="st">&quot;Navarra&quot;</span>,</span>
<span id="cb88-10"><a href="working-with-variables.html#cb88-10" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">&quot;País Vasco&quot;</span>, <span class="st">&quot;Valencia&quot;</span>)))</span></code></pre></div>
<div id="reordering-levels" class="section level3 hasAnchor" number="2.2.1">
<h3><span class="header-section-number">2.2.1</span> Reordering levels<a href="working-with-variables.html#reordering-levels" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Suppose we want to produce a bar chart to see the number of patients recruited in each region. Here we use function <code>gf_barh()</code> from <code>ggformula</code> to produce a horizontal barchart:</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="working-with-variables.html#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggformula)</span>
<span id="cb89-2"><a href="working-with-variables.html#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="fu">gf_barh</span>(<span class="sc">~</span>region, <span class="at">data =</span> ah)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-35-1.png" width="672" style="display: block; margin: auto;" /></p>
<p><br />
</p>
<p>We could make the bar chart more readable if regions were sorted by frequency. This is precisely the purpose of <code>fct_infreq()</code>:</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="working-with-variables.html#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gf_barh</span>(<span class="sc">~</span><span class="fu">fct_infreq</span>(region), <span class="at">data =</span> ah, <span class="at">ylab =</span> <span class="st">&quot;Regions&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-36-1.png" width="672" style="display: block; margin: auto;" /></p>
<p><br />
</p>
<p>To sort them in descending frequency we can use <code>fct_rev()</code>, which reverses the order of the levels of a factor. Note how we pipe this function after <code>fct_infreq(region)</code>:</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="working-with-variables.html#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gf_barh</span>(<span class="sc">~</span><span class="fu">fct_infreq</span>(region) <span class="sc">%&gt;%</span> <span class="fu">fct_rev</span>(), <span class="at">data =</span> ah, <span class="at">ylab =</span> <span class="st">&quot;Regions&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-37-1.png" width="672" style="display: block; margin: auto;" /></p>
<p><br />
</p>
<p>Sometimes we may want to order the levels of a factor by some other variable. For instance, suppose we want to explore the mean age of patients in each region. To this end, we first group by region to compute the mean for each region, ungoup, and finally produce a graphic showing mean ages by region:</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="working-with-variables.html#cb92-1" aria-hidden="true" tabindex="-1"></a>ah <span class="sc">%&gt;%</span> </span>
<span id="cb92-2"><a href="working-with-variables.html#cb92-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region) <span class="sc">%&gt;%</span> </span>
<span id="cb92-3"><a href="working-with-variables.html#cb92-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean_age =</span> <span class="fu">mean</span>(age)) <span class="sc">%&gt;%</span> </span>
<span id="cb92-4"><a href="working-with-variables.html#cb92-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb92-5"><a href="working-with-variables.html#cb92-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_point</span>(region  <span class="sc">~</span> mean_age)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-38-1.png" width="672" style="display: block; margin: auto;" /></p>
<p><br />
</p>
<p>Again, this would be much more readable with regions sorted by the mean age. This can be done by passing variable <code>mean_age</code> as second argument to function <code>fct_reorder()</code>:</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="working-with-variables.html#cb93-1" aria-hidden="true" tabindex="-1"></a>ah <span class="sc">%&gt;%</span> </span>
<span id="cb93-2"><a href="working-with-variables.html#cb93-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region) <span class="sc">%&gt;%</span> </span>
<span id="cb93-3"><a href="working-with-variables.html#cb93-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean_age =</span> <span class="fu">mean</span>(age)) <span class="sc">%&gt;%</span> </span>
<span id="cb93-4"><a href="working-with-variables.html#cb93-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb93-5"><a href="working-with-variables.html#cb93-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_point</span>(<span class="fu">fct_reorder</span>(region, mean_age) <span class="sc">~</span> mean_age, <span class="at">ylab =</span> <span class="st">&quot;Regions&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-39-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="modifying-levels" class="section level3 hasAnchor" number="2.2.2">
<h3><span class="header-section-number">2.2.2</span> Modifying levels<a href="working-with-variables.html#modifying-levels" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Changing the levels of a factor may be motivated by several reasons, such as providing better names, or grouping some levels into broader categories. There are several functions available in <code>forcats</code> to change the levels of a factor, some of which are very specialized. The most flexible one is <code>fct_recode()</code>. Here we use it to rename some of the regions according to official names. Note that new names are equated to old names (in this order), and that levels not mentioned will remain unchanged:</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="working-with-variables.html#cb94-1" aria-hidden="true" tabindex="-1"></a>ah <span class="sc">%&gt;%</span> </span>
<span id="cb94-2"><a href="working-with-variables.html#cb94-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">region =</span> <span class="fu">fct_recode</span>(region,</span>
<span id="cb94-3"><a href="working-with-variables.html#cb94-3" aria-hidden="true" tabindex="-1"></a>                             <span class="st">&quot;Principado de Asturias&quot;</span> <span class="ot">=</span> <span class="st">&quot;Asturias&quot;</span>,</span>
<span id="cb94-4"><a href="working-with-variables.html#cb94-4" aria-hidden="true" tabindex="-1"></a>                             <span class="st">&quot;Comunidad Foral de Navarra&quot;</span> <span class="ot">=</span> <span class="st">&quot;Navarra&quot;</span>,</span>
<span id="cb94-5"><a href="working-with-variables.html#cb94-5" aria-hidden="true" tabindex="-1"></a>                             <span class="st">&quot;Comunitat Valenciana&quot;</span> <span class="ot">=</span> <span class="st">&quot;Valencia&quot;</span>, </span>
<span id="cb94-6"><a href="working-with-variables.html#cb94-6" aria-hidden="true" tabindex="-1"></a>                             <span class="st">&quot;Castilla y León&quot;</span> <span class="ot">=</span> <span class="st">&quot;Castilla-León&quot;</span>,</span>
<span id="cb94-7"><a href="working-with-variables.html#cb94-7" aria-hidden="true" tabindex="-1"></a>                             <span class="st">&quot;Cominudad de Madrid&quot;</span> <span class="ot">=</span> <span class="st">&quot;Madrid&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb94-8"><a href="working-with-variables.html#cb94-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_barh</span>(<span class="sc">~</span><span class="fu">fct_infreq</span>(region) <span class="sc">%&gt;%</span> <span class="fu">fct_rev</span>(), <span class="at">ylab =</span> <span class="st">&quot;Regions&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-40-1.png" width="672" style="display: block; margin: auto;" /></p>
<p><br />
</p>
<p>If we need to group levels into broader categories, <code>str_collapse()</code> is useful, as shown in the script below. In the second argument to this function, each new (broader) level is equated to a vector of (old) levels. Again, note that levels not mentioned are kept unchanged (“Canarias” still appears in the plot since it is not classified in any of the new broader regions).</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="working-with-variables.html#cb95-1" aria-hidden="true" tabindex="-1"></a>ah <span class="sc">%&gt;%</span> </span>
<span id="cb95-2"><a href="working-with-variables.html#cb95-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">region =</span> <span class="fu">fct_collapse</span>(region,</span>
<span id="cb95-3"><a href="working-with-variables.html#cb95-3" aria-hidden="true" tabindex="-1"></a>                             <span class="st">&quot;North&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;Galicia&quot;</span>, <span class="st">&quot;Asturias&quot;</span>, <span class="st">&quot;Cantabria&quot;</span>, <span class="st">&quot;País Vasco&quot;</span>,</span>
<span id="cb95-4"><a href="working-with-variables.html#cb95-4" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&quot;Navarra&quot;</span>, <span class="st">&quot;La Rioja&quot;</span>, <span class="st">&quot;Aragón&quot;</span>),</span>
<span id="cb95-5"><a href="working-with-variables.html#cb95-5" aria-hidden="true" tabindex="-1"></a>                             <span class="st">&quot;East&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;Catalunya&quot;</span>, <span class="st">&quot;Valencia&quot;</span>, <span class="st">&quot;Murcia&quot;</span>),</span>
<span id="cb95-6"><a href="working-with-variables.html#cb95-6" aria-hidden="true" tabindex="-1"></a>                             <span class="st">&quot;South&quot;</span> <span class="ot">=</span>  <span class="st">&quot;Andalucía&quot;</span>, </span>
<span id="cb95-7"><a href="working-with-variables.html#cb95-7" aria-hidden="true" tabindex="-1"></a>                             <span class="st">&quot;Middle-West&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;Castilla-La Mancha&quot;</span>, <span class="st">&quot;Castilla-León&quot;</span>, </span>
<span id="cb95-8"><a href="working-with-variables.html#cb95-8" aria-hidden="true" tabindex="-1"></a>                                               <span class="st">&quot;Madrid&quot;</span>, <span class="st">&quot;Extremadura&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb95-9"><a href="working-with-variables.html#cb95-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_barh</span>(<span class="sc">~</span><span class="fu">fct_infreq</span>(region) <span class="sc">%&gt;%</span> <span class="fu">fct_rev</span>(), </span>
<span id="cb95-10"><a href="working-with-variables.html#cb95-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">ylab =</span> <span class="st">&quot;Regions&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-41-1.png" width="672" style="display: block; margin: auto;" /></p>
<p><br />
</p>
<p>Sometimes we may need to collapse the levels of a factor which are less represented in the data. Suppose this is the distribution of the number of patients recruited in a clinical trial:</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="working-with-variables.html#cb96-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">center =</span> <span class="fu">factor</span>(<span class="fu">paste</span>(<span class="st">&quot;Hospital&quot;</span>,<span class="fu">rep</span>(LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>], </span>
<span id="cb96-2"><a href="working-with-variables.html#cb96-2" aria-hidden="true" tabindex="-1"></a>                             <span class="at">times =</span> <span class="fu">c</span>(<span class="dv">51</span>, <span class="dv">26</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">32</span>, <span class="dv">16</span>, <span class="dv">6</span>)))))</span>
<span id="cb96-3"><a href="working-with-variables.html#cb96-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-4"><a href="working-with-variables.html#cb96-4" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb96-5"><a href="working-with-variables.html#cb96-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_barh</span>(<span class="sc">~</span>center <span class="sc">%&gt;%</span> <span class="fu">fct_rev</span>(), <span class="at">ylab =</span> <span class="st">&quot;&quot;</span>) </span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-42-1.png" width="672" style="display: block; margin: auto;" /></p>
<p><br />
</p>
<p>In such a case, we may want to pool small centers before analysis to avoid a large imbalance of centers. If none of its optional arguments is used, <code>fct_lump()</code> will pool smaller centers ensuring that the frequency of the pool will be lower than the remaining (unpooled) centers:</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="working-with-variables.html#cb97-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb97-2"><a href="working-with-variables.html#cb97-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_barh</span>(<span class="sc">~</span><span class="fu">fct_lump</span>(center) <span class="sc">%&gt;%</span> <span class="fu">fct_infreq</span>() <span class="sc">%&gt;%</span> <span class="fu">fct_rev</span>(), <span class="at">ylab =</span> <span class="st">&quot;&quot;</span>) </span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-43-1.png" width="672" style="display: block; margin: auto;" /></p>
<p><br />
</p>
<p>Not very useful in this case, since the <code>Other</code> class only contains hospital C. However, we can controll how the pooling is done using one of the two optional arguments <code>n</code> or <code>prop</code>. With <code>n</code> we can state how many centers should be kept unpooled. With <code>prop</code> we can indicate that centers with a frequency lower than <code>prop</code> should be pooled:</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="working-with-variables.html#cb98-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb98-2"><a href="working-with-variables.html#cb98-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_barh</span>(<span class="sc">~</span><span class="fu">fct_lump</span>(center, <span class="at">n =</span> <span class="dv">4</span>) <span class="sc">%&gt;%</span> <span class="fu">fct_infreq</span>() <span class="sc">%&gt;%</span> <span class="fu">fct_rev</span>(), <span class="at">ylab =</span> <span class="st">&quot;&quot;</span>) </span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-44-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="working-with-variables.html#cb99-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb99-2"><a href="working-with-variables.html#cb99-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_percentsh</span>(<span class="sc">~</span><span class="fu">fct_lump</span>(center, <span class="at">prop =</span> .<span class="dv">15</span>) <span class="sc">%&gt;%</span> <span class="fu">fct_infreq</span>() <span class="sc">%&gt;%</span> <span class="fu">fct_rev</span>(), <span class="at">ylab =</span> <span class="st">&quot;&quot;</span>) </span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-44-2.png" width="672" style="display: block; margin: auto;" /></p>
<p><br />
</p>
<p>By default, the pool is named “Other”, but the optional argument <code>other_level</code> allows to specify a different name:</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="working-with-variables.html#cb100-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb100-2"><a href="working-with-variables.html#cb100-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_barh</span>(<span class="sc">~</span><span class="fu">fct_lump</span>(center, <span class="at">n =</span> <span class="dv">4</span>, <span class="at">other_level =</span> <span class="st">&quot;Small centers&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">fct_rev</span>(), <span class="at">ylab =</span> <span class="st">&quot;&quot;</span>) </span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-45-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="ordered-factors" class="section level3 hasAnchor" number="2.2.3">
<h3><span class="header-section-number">2.2.3</span> Ordered factors<a href="working-with-variables.html#ordered-factors" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A special type of factors are <em>ordered</em> factors. The concept of an ordered factor may be a bit confusing, because the levels of a (regular) factor are always defined in a certain order, which affects how they are displayed in outputs like frequency tables or graphics. So, what is the point of <em>ordered</em> factors? In fact, the most important reason is their use in statistical models, which is different for (regular) factors and ordered factors.</p>
<p>Ordered factors can be defined with function <code>ordered()</code>, a variation of <code>factor()</code>. Consider the following example, where we create both a (regular) factor and an <em>ordered</em> factor from a character vector of NYHA classes. You will note that, when printed to the console, the levels of <code>nyha_1</code> and <code>nyha_2</code> are displayed in a slightly different way (<code>Levels: I II III IV</code> and <code>Levels: I &lt; II &lt; III &lt; IV</code>, respectively):</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="working-with-variables.html#cb101-1" aria-hidden="true" tabindex="-1"></a>nyha <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&quot;I&quot;</span>, <span class="st">&quot;II&quot;</span>, <span class="st">&quot;III&quot;</span>, <span class="st">&quot;IV&quot;</span>), <span class="dv">10</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb101-2"><a href="working-with-variables.html#cb101-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-3"><a href="working-with-variables.html#cb101-3" aria-hidden="true" tabindex="-1"></a>nyha_1 <span class="ot">&lt;-</span> <span class="fu">factor</span>(nyha)                        <span class="co"># defines a (regular) factor   </span></span>
<span id="cb101-4"><a href="working-with-variables.html#cb101-4" aria-hidden="true" tabindex="-1"></a>nyha_2 <span class="ot">&lt;-</span> <span class="fu">ordered</span>(nyha)                       <span class="co"># defines an ordered factor</span></span>
<span id="cb101-5"><a href="working-with-variables.html#cb101-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-6"><a href="working-with-variables.html#cb101-6" aria-hidden="true" tabindex="-1"></a>nyha_1</span></code></pre></div>
<pre><code>##  [1] I   III IV  I   II  II  IV  I   IV  IV 
## Levels: I II III IV</code></pre>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="working-with-variables.html#cb103-1" aria-hidden="true" tabindex="-1"></a>nyha_2</span></code></pre></div>
<pre><code>##  [1] I   III IV  I   II  II  IV  I   IV  IV 
## Levels: I &lt; II &lt; III &lt; IV</code></pre>
<p> </p>
<p>In addition, the class of <code>nyha_2</code> is not just <code>"factor"</code>, but <code>"ordered"</code> as well:</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="working-with-variables.html#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(nyha_1)</span></code></pre></div>
<pre><code>## [1] &quot;factor&quot;</code></pre>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="working-with-variables.html#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(nyha_2)</span></code></pre></div>
<pre><code>## [1] &quot;ordered&quot; &quot;factor&quot;</code></pre>
<p><br />
</p>
<p>The behavior of both regular factors and ordered factors is the same in most cases. For instance, if we produce frequency tables or graphics, the result will be exactly the same:</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="working-with-variables.html#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb109-2"><a href="working-with-variables.html#cb109-2" aria-hidden="true" tabindex="-1"></a>ggformula<span class="sc">::</span><span class="fu">gf_bar</span>(<span class="sc">~</span>nyha_1) <span class="sc">+</span> ggformula<span class="sc">::</span><span class="fu">gf_bar</span>(<span class="sc">~</span>nyha_2)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-48-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>As commented above, the most important case where a regular or an ordered factor makes a difference is statistical modeling. In any other instance, it is unlikely that you need to define an ordered factor. Although we will not discuss the use of ordered factors in statistical models here, we want to make you aware of their existence, just in case you come across them.</p>
</div>
</div>
<div id="dates" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> Dates<a href="working-with-variables.html#dates" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>R has several data structures (object classes) and functions to work with dates and date-time values, providing the functionality one may possibly need, even to deal with data from different <a href="https://en.wikipedia.org/wiki/Time_zone">timezones</a>. However, the <code>lubridate</code> package makes it easier to tackle many of the common tasks needed when processing date or date-time data in clinical studies. Because <code>lubridate</code> is not part of the <code>tidyverse</code>, we need to start by loading this package:</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="working-with-variables.html#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span></code></pre></div>
<p><br />
</p>
<div id="data-structures-for-date-and-date-time-values" class="section level3 hasAnchor" number="2.3.1">
<h3><span class="header-section-number">2.3.1</span> Data structures for date and date-time values<a href="working-with-variables.html#data-structures-for-date-and-date-time-values" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Let’s start by looking at the difference between dates and dete-time values. While dates identify calendar days, date-time values identify a point in time (to the nearest second). A couple of functions in <code>lubridate</code> are useful to see the difference between dates and date-time values: <code>today()</code>, which returns today’s date, and <code>now()</code>, which returns the current date-time:</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="working-with-variables.html#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="fu">today</span>()        <span class="co"># today&#39;s date, a date value</span></span></code></pre></div>
<pre><code>## [1] &quot;2023-01-18&quot;</code></pre>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="working-with-variables.html#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="fu">now</span>()          <span class="co"># current time, a date-time value</span></span></code></pre></div>
<pre><code>## [1] &quot;2023-01-18 11:15:07 CET&quot;</code></pre>
<p><br />
</p>
<p>Note that the date-time value produced by <code>now()</code> specifies a timezone: <code>CET</code> (standing for Central European Time). By default, this will be your computer’s system timezone, but we can specify any timezone with argument <code>tz</code>, including <code>UTC</code> (corresponding to <a href="https://en.wikipedia.org/wiki/Coordinated_Universal_Time">Coordinated Universal Time</a>:</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="working-with-variables.html#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="fu">now</span>(<span class="at">tz =</span> <span class="st">&quot;WET&quot;</span>)                  <span class="co"># Western European Time (e.g., Canary Islands) </span></span></code></pre></div>
<pre><code>## [1] &quot;2023-01-18 10:15:07 WET&quot;</code></pre>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="working-with-variables.html#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">now</span>(<span class="at">tz =</span> <span class="st">&quot;Pacific/Auckland&quot;</span>)     <span class="co"># City of New Zealand</span></span></code></pre></div>
<pre><code>## [1] &quot;2023-01-18 23:15:07 NZDT&quot;</code></pre>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="working-with-variables.html#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="fu">now</span>(<span class="at">tz =</span> <span class="st">&quot;UTC&quot;</span>)                  <span class="co"># Coordinated Universal Time</span></span></code></pre></div>
<pre><code>## [1] &quot;2023-01-18 10:15:07 UTC&quot;</code></pre>
<p><br />
</p>
<p>Using <code>class()</code> we can see what are the types of objects used to store dates and date-times in R:</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="working-with-variables.html#cb121-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">today</span>() </span>
<span id="cb121-2"><a href="working-with-variables.html#cb121-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">now</span>() </span>
<span id="cb121-3"><a href="working-with-variables.html#cb121-3" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(x)</span></code></pre></div>
<pre><code>## [1] &quot;Date&quot;</code></pre>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="working-with-variables.html#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(y)</span></code></pre></div>
<pre><code>## [1] &quot;POSIXct&quot; &quot;POSIXt&quot;</code></pre>
<p><br />
</p>
<p>As you see, dates are stored in <code>Date</code> objects, while date-times are stored as <code>POSIXct</code> (or <code>POSIXt</code>) objects. As we saw in previous sections, date-time values can be converted to date objects with <code>as.Date()</code>:</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="working-with-variables.html#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.Date</span>(y)                              <span class="co"># date-time to date</span></span></code></pre></div>
<pre><code>## [1] &quot;2023-01-18&quot;</code></pre>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="working-with-variables.html#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(<span class="fu">as.Date</span>(y))</span></code></pre></div>
<pre><code>## [1] &quot;Date&quot;</code></pre>
<p><br />
</p>
</div>
<div id="date-and-date-time-formats" class="section level3 hasAnchor" number="2.3.2">
<h3><span class="header-section-number">2.3.2</span> Date and date-time formats<a href="working-with-variables.html#date-and-date-time-formats" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>By default, R uses the <a href="https://en.wikipedia.org/wiki/ISO_8601">ISO 8601 standard notation</a> to specify dates and date-times. However, alternative notations can be used by means of <em>conversion specifications</em>. The following table shows the most common symbols used in conversion specifications (for a more complete list, see <code>?strptime</code>):</p>
<table>
<caption><span id="tab:2-strptime">Table 2.2: </span> Symbols commonly used in Date and time conversion specifications</caption>
<thead>
<tr class="header">
<th>Symbol</th>
<th align="left">Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>%a</td>
<td align="left">abbreviated weekday name</td>
</tr>
<tr class="even">
<td>%A</td>
<td align="left">full weekday name</td>
</tr>
<tr class="odd">
<td>%d</td>
<td align="left">day of the month</td>
</tr>
<tr class="even">
<td>%b</td>
<td align="left">abbreviated month name</td>
</tr>
<tr class="odd">
<td>%B</td>
<td align="left">full month name</td>
</tr>
<tr class="even">
<td>%m</td>
<td align="left">month as number</td>
</tr>
<tr class="odd">
<td>%y</td>
<td align="left">year without century</td>
</tr>
<tr class="even">
<td>%Y</td>
<td align="left">year with century</td>
</tr>
<tr class="odd">
<td>%H</td>
<td align="left">hour</td>
</tr>
<tr class="even">
<td>%M</td>
<td align="left">minute</td>
</tr>
<tr class="odd">
<td>%S</td>
<td align="left">second</td>
</tr>
<tr class="even">
<td>%T</td>
<td align="left">equivalent to %H:%M:%S</td>
</tr>
</tbody>
</table>
<p><br />
</p>
<p>These conversion specifications are used in a format string (e.g., <code>"%d %B %Y"</code>). Any other character included in the format string is interpreted literally.</p>
<p>Function <code>format()</code> can be used to create a character string with the desired notation, as shown in these examples:</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="working-with-variables.html#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="fu">format</span>(x, <span class="at">format =</span> <span class="st">&quot;%A %d %B %Y&quot;</span>) </span></code></pre></div>
<pre><code>## [1] &quot;Wednesday 18 January 2023&quot;</code></pre>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="working-with-variables.html#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="fu">format</span>(y, <span class="st">&quot;%d-%b-%Y, %T %Z&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;18-Jan-2023, 11:15:07 CET&quot;</code></pre>
<p><br />
</p>
<p>Similarly, we can read dates from character vectors expressing calendar dates in an specific notation, by specifying it in the <code>format</code> argument of <code>as.Date()</code>:</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="working-with-variables.html#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.Date</span>(<span class="st">&quot;05/03/2001&quot;</span>, <span class="at">format =</span> <span class="st">&quot;%d/%m/%Y&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2001-03-05&quot;</code></pre>
<!-- While dates are extremely common in clinical studies, date-times are not, so that we will not pursue the discussion on how to work with them. Rather, we will concentrate on the needs that arise concerning dates.  -->
</div>
<div id="reading-dates" class="section level3 hasAnchor" number="2.3.3">
<h3><span class="header-section-number">2.3.3</span> Reading dates<a href="working-with-variables.html#reading-dates" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Probably the most common problem with dates arises when reading data from external files in which calendar dates are indicated in strings using a specific notation (like “dd/mm/YYYY”). As we have seen in the previous section, these can be read and converted to <code>date</code> objects with <code>as.Date()</code>, provided the notation is consistent. However, inconsistent notation of dates is not uncommon, and cannot be handled by <code>as.Date()</code>.</p>
<p>Fortunately, <code>lubridate</code> includes a family of functions that are able to parse dates from input vectors containing mixed date notations, provided the ordering of the date components is always the same. These functions are named according to the <em>order</em> of the date components. For instance, the following strings contain highly heterogeneous date notations, but the components are always in the same order (day, month and year), so that we can use function <code>dmy()</code> to read them:</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="working-with-variables.html#cb135-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;15-sep-03&quot;</span>, <span class="st">&quot;24/08/1987&quot;</span>, <span class="st">&quot;Tuesday 25 March 1958&quot;</span>, <span class="st">&quot;02121957&quot;</span>)</span>
<span id="cb135-2"><a href="working-with-variables.html#cb135-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dmy</span>(x)</span></code></pre></div>
<pre><code>## [1] &quot;2003-09-15&quot; &quot;1987-08-24&quot; &quot;1958-03-25&quot; &quot;1957-12-02&quot;</code></pre>
<p><br />
</p>
<p>Similar functions are available for the remaining possible orderings: <code>dym()</code>, ymd()<code>,</code>ydm()<code>,</code>mdy()<code>, or</code>myd()`. For intance:</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="working-with-variables.html#cb137-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;2003, 15-sep&quot;</span>, <span class="st">&quot;1987 24/08&quot;</span>, <span class="st">&quot;1950, Tuesday 25 March&quot;</span>, <span class="st">&quot;19570212&quot;</span>)</span>
<span id="cb137-2"><a href="working-with-variables.html#cb137-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ydm</span>(x)</span></code></pre></div>
<pre><code>## [1] &quot;2003-09-15&quot; &quot;1987-08-24&quot; &quot;1950-03-25&quot; &quot;1957-12-02&quot;</code></pre>
<p><br />
</p>
<p>Other functions of this family allow to parse incomplete dates, like year and month or year and quarter providing the date of the first day in the interval:</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="working-with-variables.html#cb139-1" aria-hidden="true" tabindex="-1"></a>partial <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;2003-sep&quot;</span>, <span class="st">&quot;1987.08&quot;</span>, <span class="st">&quot;1950 March&quot;</span>, <span class="st">&quot;1957.2&quot;</span>)      <span class="co"># year and month</span></span>
<span id="cb139-2"><a href="working-with-variables.html#cb139-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ym</span>(partial)</span></code></pre></div>
<pre><code>## [1] &quot;2003-09-01&quot; &quot;1987-08-01&quot; &quot;1950-03-01&quot; &quot;1957-02-01&quot;</code></pre>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="working-with-variables.html#cb141-1" aria-hidden="true" tabindex="-1"></a>partial  <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;2003-3&quot;</span>, <span class="st">&quot;1987.3&quot;</span>, <span class="st">&quot;1950 1&quot;</span>, <span class="st">&quot;1957.1&quot;</span>)            <span class="co"># year and quarter</span></span>
<span id="cb141-2"><a href="working-with-variables.html#cb141-2" aria-hidden="true" tabindex="-1"></a><span class="fu">yq</span>(partial)</span></code></pre></div>
<pre><code>## [1] &quot;2003-07-01&quot; &quot;1987-07-01&quot; &quot;1950-01-01&quot; &quot;1957-01-01&quot;</code></pre>
<p><br />
</p>
<p>Sometimes dates are split in diferent variables for the year, the month and the day. In such a case, a date can be formed with function <code>make_date()</code>, whose arguments are pretty obvious. Note that arguments can be numeric, character, or mixed types:</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="working-with-variables.html#cb143-1" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="st">&quot;2001&quot;</span></span>
<span id="cb143-2"><a href="working-with-variables.html#cb143-2" aria-hidden="true" tabindex="-1"></a>x2 <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb143-3"><a href="working-with-variables.html#cb143-3" aria-hidden="true" tabindex="-1"></a>x3 <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb143-4"><a href="working-with-variables.html#cb143-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-5"><a href="working-with-variables.html#cb143-5" aria-hidden="true" tabindex="-1"></a>the_date <span class="ot">&lt;-</span> <span class="fu">make_date</span>(<span class="at">year =</span> x1, <span class="at">month =</span> x2, <span class="at">day =</span> x3)</span>
<span id="cb143-6"><a href="working-with-variables.html#cb143-6" aria-hidden="true" tabindex="-1"></a>the_date</span></code></pre></div>
<pre><code>## [1] &quot;2001-03-05&quot;</code></pre>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="working-with-variables.html#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(the_date)</span></code></pre></div>
<pre><code>## [1] &quot;Date&quot;</code></pre>
</div>
<div id="getting-date-components" class="section level3 hasAnchor" number="2.3.4">
<h3><span class="header-section-number">2.3.4</span> Getting date components<a href="working-with-variables.html#getting-date-components" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>When components have to be extracted from dates, functions with obvious names are available as shown in the following examples:</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="working-with-variables.html#cb147-1" aria-hidden="true" tabindex="-1"></a>bd <span class="ot">&lt;-</span> <span class="fu">ydm</span>(x)              <span class="co"># a vector of birth dates</span></span>
<span id="cb147-2"><a href="working-with-variables.html#cb147-2" aria-hidden="true" tabindex="-1"></a>bd</span></code></pre></div>
<pre><code>## [1] &quot;2003-09-15&quot; &quot;1987-08-24&quot; &quot;1950-03-25&quot; &quot;1957-12-02&quot;</code></pre>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="working-with-variables.html#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="fu">year</span>(bd)                  <span class="co"># get the year</span></span></code></pre></div>
<pre><code>## [1] 2003 1987 1950 1957</code></pre>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="working-with-variables.html#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="fu">month</span>(bd)                 <span class="co"># get the month</span></span></code></pre></div>
<pre><code>## [1]  9  8  3 12</code></pre>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="working-with-variables.html#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="fu">day</span>(bd)                   <span class="co"># get the day of month</span></span></code></pre></div>
<pre><code>## [1] 15 24 25  2</code></pre>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="working-with-variables.html#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wday</span>(bd)                  <span class="co"># get the day of the week (1 to 7, starting on sunday)</span></span></code></pre></div>
<pre><code>## [1] 2 2 7 2</code></pre>
<p> </p>
<p>In the case of months and days of the week, argument <code>label = TRUE</code> will provide their names instead of numbers, either abbraviated (default) or full (if argument <code>abbr</code>is set to <code>FALSE</code>). Nothe that in this case the result is a ordered factor:</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="working-with-variables.html#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="fu">month</span>(bd, <span class="at">label=</span><span class="cn">TRUE</span>)                    </span></code></pre></div>
<pre><code>## [1] Sep Aug Mar Dec
## 12 Levels: Jan &lt; Feb &lt; Mar &lt; Apr &lt; May &lt; Jun &lt; Jul &lt; Aug &lt; Sep &lt; ... &lt; Dec</code></pre>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="working-with-variables.html#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wday</span>(bd, <span class="at">label=</span><span class="cn">TRUE</span>, <span class="at">abbr=</span><span class="cn">FALSE</span>)      </span></code></pre></div>
<pre><code>## [1] Monday   Monday   Saturday Monday  
## 7 Levels: Sunday &lt; Monday &lt; Tuesday &lt; Wednesday &lt; Thursday &lt; ... &lt; Saturday</code></pre>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="working-with-variables.html#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="fu">month</span>(bd, <span class="at">label=</span><span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="fu">class</span>()</span></code></pre></div>
<pre><code>## [1] &quot;ordered&quot; &quot;factor&quot;</code></pre>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="working-with-variables.html#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wday</span>(bd, <span class="at">label=</span><span class="cn">TRUE</span>, <span class="at">abbr=</span><span class="cn">FALSE</span>)  <span class="sc">%&gt;%</span> <span class="fu">class</span>()</span></code></pre></div>
<pre><code>## [1] &quot;ordered&quot; &quot;factor&quot;</code></pre>
<p><br />
</p>
</div>
<div id="a-closer-look-to-dates" class="section level3 hasAnchor" number="2.3.5">
<h3><span class="header-section-number">2.3.5</span> A closer look to dates<a href="working-with-variables.html#a-closer-look-to-dates" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Up to now we have seen how dates <em>look</em> when printed to the console, but this is not what the <em>are</em>. In fact, dates are numeric vectors, as the following will reveal:</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="working-with-variables.html#cb165-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">c</span>(<span class="st">&quot;2003-09-15&quot;</span>, <span class="st">&quot;1987-08-24&quot;</span>, <span class="st">&quot;1950-03-25&quot;</span>, <span class="st">&quot;1957-12-02&quot;</span>))</span>
<span id="cb165-2"><a href="working-with-variables.html#cb165-2" aria-hidden="true" tabindex="-1"></a>xx <span class="ot">&lt;-</span> <span class="fu">unclass</span>(x)</span>
<span id="cb165-3"><a href="working-with-variables.html#cb165-3" aria-hidden="true" tabindex="-1"></a>xx</span></code></pre></div>
<pre><code>## [1] 12310  6444 -7222 -4413</code></pre>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="working-with-variables.html#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(xx)</span></code></pre></div>
<pre><code>## [1] &quot;numeric&quot;</code></pre>
<p><br />
</p>
<p>As you see, the actual contents is 12310, 6444, -7222, -4413, and this is the number of days elapsed since an arbitrary <em>origin</em> (set to the first of January 1970). Thus, dates are stored as the number of days elapsed since the origin, as illustrated in figure @ref(fig:dates_internal) (note that dates before the origin are stored as negative numbers).</p>
<div class="figure" style="text-align: center">
<img src="data/Timeline_for_dates.png" alt="Dates as stored in R" width="1903" />
<p class="caption">
(#fig:dates_internal)Dates as stored in R
</p>
</div>
<p><br />
</p>
<p>Package <code>lubridate</code> includes the date-time object <code>origin</code>, so that we can see what’s the origin:</p>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="working-with-variables.html#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.Date</span>(origin)</span></code></pre></div>
<pre><code>## [1] &quot;1970-01-01&quot;</code></pre>
<p> </p>
<p>Now, we can easily verify that the values 12310, 6444, -7222, -4413 stored in date <code>x</code> above are nothing but the numbers of days elapsed since the origin:</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="working-with-variables.html#cb171-1" aria-hidden="true" tabindex="-1"></a>x <span class="sc">-</span> <span class="fu">as.Date</span>(origin)</span></code></pre></div>
<pre><code>## Time differences in days
## [1] 12310  6444 -7222 -4413</code></pre>
<p><br />
Or equivalently, we may add this number of days to the origin and we will get the dates in <code>x</code>.</p>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="working-with-variables.html#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.Date</span>(origin) <span class="sc">+</span> xx</span></code></pre></div>
<pre><code>## [1] &quot;2003-09-15&quot; &quot;1987-08-24&quot; &quot;1950-03-25&quot; &quot;1957-12-02&quot;</code></pre>
<p>In summary, a <code>date</code> object is a numeric vector containing whole numbers (the number of days elapsed since the 1st Jan 1970), that have been given the <em>class</em> atribute <code>Date</code>. He is a demo:</p>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="working-with-variables.html#cb175-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span></span>
<span id="cb175-2"><a href="working-with-variables.html#cb175-2" aria-hidden="true" tabindex="-1"></a>x</span></code></pre></div>
<pre><code>## [1] 1 2 3 4 5 6 7</code></pre>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="working-with-variables.html#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(x)</span></code></pre></div>
<pre><code>## [1] &quot;integer&quot;</code></pre>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="working-with-variables.html#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(x) <span class="ot">&lt;-</span> <span class="st">&quot;Date&quot;</span></span>
<span id="cb179-2"><a href="working-with-variables.html#cb179-2" aria-hidden="true" tabindex="-1"></a>x</span></code></pre></div>
<pre><code>## [1] &quot;1970-01-02&quot; &quot;1970-01-03&quot; &quot;1970-01-04&quot; &quot;1970-01-05&quot; &quot;1970-01-06&quot;
## [6] &quot;1970-01-07&quot; &quot;1970-01-08&quot;</code></pre>
</div>
<div id="shifting-dates" class="section level3 hasAnchor" number="2.3.6">
<h3><span class="header-section-number">2.3.6</span> Shifting dates<a href="working-with-variables.html#shifting-dates" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Sometimes we may need to create a sequence of dates from a starting point in time. For instance, consider a study in which monthly visits are planned after enrollment of a patient. If we want to evaluate the difference between planned and actual visit dates, we need to create the sequence of planned dates to compare them to actual dates.</p>
<p>If visit intervals are defined by a fixed number of days (say, 30 days) we just need to add this number to the enrollment date.</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="working-with-variables.html#cb181-1" aria-hidden="true" tabindex="-1"></a>enrollment <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">&quot;2022-01-01&quot;</span>)</span>
<span id="cb181-2"><a href="working-with-variables.html#cb181-2" aria-hidden="true" tabindex="-1"></a>enrollment</span></code></pre></div>
<pre><code>## [1] &quot;2022-01-01&quot;</code></pre>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="working-with-variables.html#cb183-1" aria-hidden="true" tabindex="-1"></a>intervals <span class="ot">&lt;-</span> <span class="dv">30</span> <span class="sc">*</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">6</span></span>
<span id="cb183-2"><a href="working-with-variables.html#cb183-2" aria-hidden="true" tabindex="-1"></a>intervals</span></code></pre></div>
<pre><code>## [1]   0  30  60  90 120 150 180</code></pre>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="working-with-variables.html#cb185-1" aria-hidden="true" tabindex="-1"></a>enrollment <span class="sc">+</span> intervals</span></code></pre></div>
<pre><code>## [1] &quot;2022-01-01&quot; &quot;2022-01-31&quot; &quot;2022-03-02&quot; &quot;2022-04-01&quot; &quot;2022-05-01&quot;
## [6] &quot;2022-05-31&quot; &quot;2022-06-30&quot;</code></pre>
<p> </p>
<p>Alternatively, we might prefer to set intervals as natural months, but this is not straightforward since the number of days in a month is not constant. Fortunately, <code>lubridate</code> has a family of functions that create natural <em>periods</em> like months, weeks, or years. These functions take the name of the periods they create, and allow to indicate the number of periods want to create as a numeric vector:</p>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb187-1"><a href="working-with-variables.html#cb187-1" aria-hidden="true" tabindex="-1"></a>enrollment <span class="sc">+</span> <span class="fu">months</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">6</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2022-01-01&quot; &quot;2022-02-01&quot; &quot;2022-03-01&quot; &quot;2022-04-01&quot; &quot;2022-05-01&quot;
## [6] &quot;2022-06-01&quot; &quot;2022-07-01&quot;</code></pre>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="working-with-variables.html#cb189-1" aria-hidden="true" tabindex="-1"></a>enrollment <span class="sc">+</span> <span class="fu">years</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">5</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2022-01-01&quot; &quot;2023-01-01&quot; &quot;2024-01-01&quot; &quot;2025-01-01&quot; &quot;2026-01-01&quot;
## [6] &quot;2027-01-01&quot;</code></pre>
<p><br />
</p>
<p>If the addition of periods results in a non-existing date, these functions will return <code>NA</code>:</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="working-with-variables.html#cb191-1" aria-hidden="true" tabindex="-1"></a>enrollment <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">&quot;2001-01-31&quot;</span>)</span>
<span id="cb191-2"><a href="working-with-variables.html#cb191-2" aria-hidden="true" tabindex="-1"></a>enrollment <span class="sc">+</span> <span class="fu">months</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">6</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2001-01-31&quot; NA           &quot;2001-03-31&quot; NA           &quot;2001-05-31&quot;
## [6] NA           &quot;2001-07-31&quot;</code></pre>
<p> </p>
<p>To avoid this, the operator <code>%m+%</code> should be used:</p>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="working-with-variables.html#cb193-1" aria-hidden="true" tabindex="-1"></a>enrollment <span class="sc">%m+%</span> <span class="fu">months</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">6</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2001-01-31&quot; &quot;2001-02-28&quot; &quot;2001-03-31&quot; &quot;2001-04-30&quot; &quot;2001-05-31&quot;
## [6] &quot;2001-06-30&quot; &quot;2001-07-31&quot;</code></pre>
<p> </p>
<p>And similarly for leap years:</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="working-with-variables.html#cb195-1" aria-hidden="true" tabindex="-1"></a><span class="fu">leap_year</span>(<span class="dv">2020</span>)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="working-with-variables.html#cb197-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.Date</span>(<span class="st">&quot;2020-02-29&quot;</span>) <span class="sc">+</span> <span class="fu">years</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">5</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2020-02-29&quot; NA           NA           NA           &quot;2024-02-29&quot;
## [6] NA</code></pre>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="working-with-variables.html#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.Date</span>(<span class="st">&quot;2020-02-29&quot;</span>) <span class="sc">%m+%</span> <span class="fu">years</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">5</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2020-02-29&quot; &quot;2021-02-28&quot; &quot;2022-02-28&quot; &quot;2023-02-28&quot; &quot;2024-02-29&quot;
## [6] &quot;2025-02-28&quot;</code></pre>
</div>
<div id="intervals" class="section level3 hasAnchor" number="2.3.7">
<h3><span class="header-section-number">2.3.7</span> Intervals<a href="working-with-variables.html#intervals" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Intervals are timespans bounded by start and end dates. Intervals can be created with function<code>interval()</code>, or with the operator <code>%--%</code>, from either <code>Date</code> objects or strings in ISO 8601 format:</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="working-with-variables.html#cb201-1" aria-hidden="true" tabindex="-1"></a>birth <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">&quot;2001-03-05&quot;</span>)</span>
<span id="cb201-2"><a href="working-with-variables.html#cb201-2" aria-hidden="true" tabindex="-1"></a><span class="fu">interval</span>(<span class="at">start =</span> birth, <span class="at">end =</span> <span class="fu">today</span>())       <span class="co"># from Dates</span></span></code></pre></div>
<pre><code>## [1] 2001-03-05 UTC--2023-01-18 UTC</code></pre>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="working-with-variables.html#cb203-1" aria-hidden="true" tabindex="-1"></a>birth <span class="sc">%--%</span> <span class="fu">today</span>()                           <span class="co"># using %--%</span></span></code></pre></div>
<pre><code>## [1] 2001-03-05 UTC--2023-01-18 UTC</code></pre>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="working-with-variables.html#cb205-1" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;2001-03-05&quot;</span> <span class="sc">%--%</span> <span class="fu">today</span>()                    <span class="co"># from ISO 8601 strings</span></span></code></pre></div>
<pre><code>## [1] 2001-03-05 UTC--2023-01-18 UTC</code></pre>
<p>We can use intervals in several ways. For instance, we can use them to compute age at enrollment. To this end, we divide the interval between birth and enrollment dates by a period of one year. If we want to express age in completed years (as we usually do), we truncate the result :</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="working-with-variables.html#cb207-1" aria-hidden="true" tabindex="-1"></a>birth <span class="sc">%--%</span> <span class="fu">today</span>() <span class="sc">/</span> <span class="fu">years</span>(<span class="dv">1</span>)                   <span class="co"># age in years</span></span></code></pre></div>
<pre><code>## [1] 21.87397</code></pre>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="working-with-variables.html#cb209-1" aria-hidden="true" tabindex="-1"></a><span class="fu">trunc</span>(birth <span class="sc">%--%</span> <span class="fu">today</span>() <span class="sc">/</span> <span class="fu">years</span>(<span class="dv">1</span>))            <span class="co"># age in complete years</span></span></code></pre></div>
<pre><code>## [1] 21</code></pre>
<p><br />
</p>
<p>Another interesting use of intervals is the detection of overlapping intervals. For instance, we may want to know if a concomitant medication was taken during a specific phase of a clinical trial. This can be done with function <code>int_overlaps()</code>, passing it the two intervals as arguments:</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="working-with-variables.html#cb211-1" aria-hidden="true" tabindex="-1"></a>treatment_phase <span class="ot">&lt;-</span> <span class="fu">interval</span>(<span class="st">&quot;2021-01-01&quot;</span>, <span class="st">&quot;2021-03-31&quot;</span>)</span>
<span id="cb211-2"><a href="working-with-variables.html#cb211-2" aria-hidden="true" tabindex="-1"></a>steroids <span class="ot">&lt;-</span> <span class="fu">interval</span>(<span class="st">&quot;2020-12-15&quot;</span>, <span class="st">&quot;2020-12-31&quot;</span>)</span>
<span id="cb211-3"><a href="working-with-variables.html#cb211-3" aria-hidden="true" tabindex="-1"></a>statins <span class="ot">&lt;-</span> <span class="fu">interval</span>(<span class="st">&quot;2021-02-15&quot;</span>, <span class="fu">today</span>())</span>
<span id="cb211-4"><a href="working-with-variables.html#cb211-4" aria-hidden="true" tabindex="-1"></a><span class="fu">int_overlaps</span>(treatment_phase, steroids)</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="working-with-variables.html#cb213-1" aria-hidden="true" tabindex="-1"></a><span class="fu">int_overlaps</span>(treatment_phase, statins)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p><br />
</p>
<p>Last, intervals can be created also from a sequence of dates stored in a vector, with function <code>int_diff</code>()`. This will create intervals defined by two consecutive visits:</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="working-with-variables.html#cb215-1" aria-hidden="true" tabindex="-1"></a>visits <span class="ot">&lt;-</span> enrollment <span class="sc">%m+%</span> <span class="fu">months</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">6</span>)</span>
<span id="cb215-2"><a href="working-with-variables.html#cb215-2" aria-hidden="true" tabindex="-1"></a>visits</span></code></pre></div>
<pre><code>## [1] &quot;2001-01-31&quot; &quot;2001-02-28&quot; &quot;2001-03-31&quot; &quot;2001-04-30&quot; &quot;2001-05-31&quot;
## [6] &quot;2001-06-30&quot; &quot;2001-07-31&quot;</code></pre>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="working-with-variables.html#cb217-1" aria-hidden="true" tabindex="-1"></a><span class="fu">int_diff</span>(visits)</span></code></pre></div>
<pre><code>## [1] 2001-01-31 UTC--2001-02-28 UTC 2001-02-28 UTC--2001-03-31 UTC
## [3] 2001-03-31 UTC--2001-04-30 UTC 2001-04-30 UTC--2001-05-31 UTC
## [5] 2001-05-31 UTC--2001-06-30 UTC 2001-06-30 UTC--2001-07-31 UTC</code></pre>
</div>
</div>
<div id="dataframe-variables" class="section level2 hasAnchor" number="2.4">
<h2><span class="header-section-number">2.4</span> Dataframe variables<a href="working-with-variables.html#dataframe-variables" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In previous sections we have illustrated how to use of several functions to work with strings, factors and dates. To keep the examples code as simple as possible, we illustrated their use on vectors. However, when processing real data, it is very likely that we need to create new variables in a dataframe, which can be achieved with the <code>mutate()</code> function in <code>dplyr</code>. Any of the functions we have discussed can be used within a <code>mutate()</code> statement.</p>
<p>For instance, when reading the DISETAHE MS Excel file, the two variables containing dates (<code>data_xtract_dt</code> and <code>ah_dx_dt</code>) are date-time objects in the resulting dataframe:</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="working-with-variables.html#cb219-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb219-2"><a href="working-with-variables.html#cb219-2" aria-hidden="true" tabindex="-1"></a>demo <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">&quot;./data/hta.xlsx&quot;</span>, <span class="at">sheet =</span> <span class="st">&quot;data&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb219-3"><a href="working-with-variables.html#cb219-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(pid, data_xtract_dt, region, age, sex, ah_dx_dt)</span>
<span id="cb219-4"><a href="working-with-variables.html#cb219-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-5"><a href="working-with-variables.html#cb219-5" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(demo<span class="sc">$</span>data_xtract_dt)</span></code></pre></div>
<pre><code>## [1] &quot;POSIXct&quot; &quot;POSIXt&quot;</code></pre>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="working-with-variables.html#cb221-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(demo<span class="sc">$</span>ah_dx_dt)</span></code></pre></div>
<pre><code>## [1] &quot;POSIXct&quot; &quot;POSIXt&quot;</code></pre>
<p><br />
</p>
<p>But when these variables are printed, we see that the time value non-informative (it is always <code>00:00:00</code>):</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="working-with-variables.html#cb223-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(demo)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 6
##     pid data_xtract_dt      region   age   sex ah_dx_dt           
##   &lt;dbl&gt; &lt;dttm&gt;               &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dttm&gt;             
## 1    11 2003-03-15 00:00:00      6    52     1 1998-01-01 00:00:00
## 2    15 2003-03-15 00:00:00      6    57     2 1997-01-01 00:00:00
## 3    20 2003-05-13 00:00:00      1    62     1 2003-04-10 00:00:00
## 4    24 2003-05-27 00:00:00     10    69     2 1993-01-01 00:00:00
## 5    33 2003-05-28 00:00:00     10    70     2 1994-01-01 00:00:00
## 6    37 2003-06-14 00:00:00      9    64     2 1995-04-07 00:00:00</code></pre>
<p> </p>
<p>To convert these variables to the simpler and more convenient <code>Date</code> class, the <code>as.Date()</code> function may be used in a <code>mutate()</code> statement:</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="working-with-variables.html#cb225-1" aria-hidden="true" tabindex="-1"></a>demo <span class="sc">%&gt;%</span> </span>
<span id="cb225-2"><a href="working-with-variables.html#cb225-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data_xtract_dt =</span> <span class="fu">as.Date</span>(data_xtract_dt),</span>
<span id="cb225-3"><a href="working-with-variables.html#cb225-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">ah_dx_dt =</span> <span class="fu">as.Date</span>(ah_dx_dt))</span></code></pre></div>
<pre><code>## # A tibble: 500 × 6
##      pid data_xtract_dt region   age   sex ah_dx_dt  
##    &lt;dbl&gt; &lt;date&gt;          &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;date&gt;    
##  1    11 2003-03-15          6    52     1 1998-01-01
##  2    15 2003-03-15          6    57     2 1997-01-01
##  3    20 2003-05-13          1    62     1 2003-04-10
##  4    24 2003-05-27         10    69     2 1993-01-01
##  5    33 2003-05-28         10    70     2 1994-01-01
##  6    37 2003-06-14          9    64     2 1995-04-07
##  7    50 2003-06-16          2    55     2 NA        
##  8    83 2004-03-15          5    64     1 1981-01-01
##  9    91 2004-03-15          5    57     1 1996-01-01
## 10   114 2004-04-05          5    73     2 1991-06-04
## # … with 490 more rows</code></pre>
<p><br />
</p>
<p>While this is fine because we need to convert two variables only, it may be cumbersome when many variables have to be converted.</p>
<div id="processing-several-variables-at-once" class="section level3 hasAnchor" number="2.4.1">
<h3><span class="header-section-number">2.4.1</span> Processing several variables at once<a href="working-with-variables.html#processing-several-variables-at-once" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>When several variables have to be processed the same way, a better approach is to use <code>across()</code> within <code>mutate()</code>. The <code>across()</code> function takes two arguments. This first argument indicates the variables to be processed, and the second argument specifies the function to be applied to these variables:</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="working-with-variables.html#cb227-1" aria-hidden="true" tabindex="-1"></a>demo <span class="sc">%&gt;%</span> </span>
<span id="cb227-2"><a href="working-with-variables.html#cb227-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(data_xtract_dt, ah_dx_dt), as.Date))</span></code></pre></div>
<pre><code>## # A tibble: 500 × 6
##      pid data_xtract_dt region   age   sex ah_dx_dt  
##    &lt;dbl&gt; &lt;date&gt;          &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;date&gt;    
##  1    11 2003-03-15          6    52     1 1998-01-01
##  2    15 2003-03-15          6    57     2 1997-01-01
##  3    20 2003-05-13          1    62     1 2003-04-10
##  4    24 2003-05-27         10    69     2 1993-01-01
##  5    33 2003-05-28         10    70     2 1994-01-01
##  6    37 2003-06-14          9    64     2 1995-04-07
##  7    50 2003-06-16          2    55     2 NA        
##  8    83 2004-03-15          5    64     1 1981-01-01
##  9    91 2004-03-15          5    57     1 1996-01-01
## 10   114 2004-04-05          5    73     2 1991-06-04
## # … with 490 more rows</code></pre>
<p><br />
</p>
<p>In the first argument, helper functions can be used just like with <code>select()</code>:</p>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="working-with-variables.html#cb229-1" aria-hidden="true" tabindex="-1"></a>demo <span class="sc">%&gt;%</span> </span>
<span id="cb229-2"><a href="working-with-variables.html#cb229-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">ends_with</span>(<span class="st">&quot;dt&quot;</span>), as.Date))</span></code></pre></div>
<pre><code>## # A tibble: 500 × 6
##      pid data_xtract_dt region   age   sex ah_dx_dt  
##    &lt;dbl&gt; &lt;date&gt;          &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;date&gt;    
##  1    11 2003-03-15          6    52     1 1998-01-01
##  2    15 2003-03-15          6    57     2 1997-01-01
##  3    20 2003-05-13          1    62     1 2003-04-10
##  4    24 2003-05-27         10    69     2 1993-01-01
##  5    33 2003-05-28         10    70     2 1994-01-01
##  6    37 2003-06-14          9    64     2 1995-04-07
##  7    50 2003-06-16          2    55     2 NA        
##  8    83 2004-03-15          5    64     1 1981-01-01
##  9    91 2004-03-15          5    57     1 1996-01-01
## 10   114 2004-04-05          5    73     2 1991-06-04
## # … with 490 more rows</code></pre>
<p><br />
</p>
<p>If the function to be applied needs some arguments, they can be passed as further arguments to <code>across()</code>. For instance, suppose we want to define factors for all treatment variables in the DISETAHE study. Because all of them are coded the same way, the factor definition is identical for all:</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="working-with-variables.html#cb231-1" aria-hidden="true" tabindex="-1"></a>treatments <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">&quot;./data/hta.xlsx&quot;</span>, <span class="at">sheet =</span> <span class="st">&quot;data&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb231-2"><a href="working-with-variables.html#cb231-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(pid, lmr<span class="sc">:</span>other) </span>
<span id="cb231-3"><a href="working-with-variables.html#cb231-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-4"><a href="working-with-variables.html#cb231-4" aria-hidden="true" tabindex="-1"></a>treatments <span class="sc">%&gt;%</span> </span>
<span id="cb231-5"><a href="working-with-variables.html#cb231-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lmr =</span> <span class="fu">factor</span>(lmr, <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;yes&quot;</span>, <span class="st">&quot;no&quot;</span>)),</span>
<span id="cb231-6"><a href="working-with-variables.html#cb231-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">bb =</span> <span class="fu">factor</span>(bb, <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;yes&quot;</span>, <span class="st">&quot;no&quot;</span>)),</span>
<span id="cb231-7"><a href="working-with-variables.html#cb231-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">diur =</span> <span class="fu">factor</span>(diur, <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;yes&quot;</span>, <span class="st">&quot;no&quot;</span>)),</span>
<span id="cb231-8"><a href="working-with-variables.html#cb231-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">acei =</span> <span class="fu">factor</span>(acei, <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;yes&quot;</span>, <span class="st">&quot;no&quot;</span>)),</span>
<span id="cb231-9"><a href="working-with-variables.html#cb231-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">arb =</span> <span class="fu">factor</span>(arb, <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;yes&quot;</span>, <span class="st">&quot;no&quot;</span>)),</span>
<span id="cb231-10"><a href="working-with-variables.html#cb231-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">cbb =</span> <span class="fu">factor</span>(cbb, <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;yes&quot;</span>, <span class="st">&quot;no&quot;</span>)),</span>
<span id="cb231-11"><a href="working-with-variables.html#cb231-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">ab =</span> <span class="fu">factor</span>(ab, <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;yes&quot;</span>, <span class="st">&quot;no&quot;</span>)),</span>
<span id="cb231-12"><a href="working-with-variables.html#cb231-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">other =</span> <span class="fu">factor</span>(other, <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;yes&quot;</span>, <span class="st">&quot;no&quot;</span>)))</span></code></pre></div>
<pre><code>## # A tibble: 500 × 9
##      pid lmr   bb    diur  acei  arb   cbb   ab    other
##    &lt;dbl&gt; &lt;fct&gt; &lt;fct&gt; &lt;fct&gt; &lt;fct&gt; &lt;fct&gt; &lt;fct&gt; &lt;fct&gt; &lt;fct&gt;
##  1    11 yes   yes   no    no    no    no    no    no   
##  2    15 yes   no    no    yes   no    no    no    no   
##  3    20 yes   no    no    no    no    no    no    no   
##  4    24 yes   no    yes   no    no    no    no    no   
##  5    33 yes   no    yes   no    no    no    no    no   
##  6    37 yes   no    yes   no    yes   no    no    no   
##  7    50 no    no    no    no    no    no    no    no   
##  8    83 yes   no    no    no    no    no    no    yes  
##  9    91 yes   no    no    yes   no    no    no    no   
## 10   114 yes   no    yes   no    yes   no    no    no   
## # … with 490 more rows</code></pre>
<p><br />
</p>
<p>Using <code>across()</code>, we need to pass the <code>factor</code> function as second argument, and the <code>levels</code> and <code>labels</code> arguments as further arguments:</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="working-with-variables.html#cb233-1" aria-hidden="true" tabindex="-1"></a>treatments <span class="sc">%&gt;%</span> </span>
<span id="cb233-2"><a href="working-with-variables.html#cb233-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(lmr<span class="sc">:</span>other, factor, <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;yes&quot;</span>, <span class="st">&quot;no&quot;</span>)))</span></code></pre></div>
<pre><code>## # A tibble: 500 × 9
##      pid lmr   bb    diur  acei  arb   cbb   ab    other
##    &lt;dbl&gt; &lt;fct&gt; &lt;fct&gt; &lt;fct&gt; &lt;fct&gt; &lt;fct&gt; &lt;fct&gt; &lt;fct&gt; &lt;fct&gt;
##  1    11 yes   yes   no    no    no    no    no    no   
##  2    15 yes   no    no    yes   no    no    no    no   
##  3    20 yes   no    no    no    no    no    no    no   
##  4    24 yes   no    yes   no    no    no    no    no   
##  5    33 yes   no    yes   no    no    no    no    no   
##  6    37 yes   no    yes   no    yes   no    no    no   
##  7    50 no    no    no    no    no    no    no    no   
##  8    83 yes   no    no    no    no    no    no    yes  
##  9    91 yes   no    no    yes   no    no    no    no   
## 10   114 yes   no    yes   no    yes   no    no    no   
## # … with 490 more rows</code></pre>
<p><br />
</p>
<p>Sometimes we may want to identify the variables to be processed by their type. For instance, suppose that diagnostic variables had been defined as logical variables, as is the case in dataframe <code>diag</code> below:</p>
<pre><code>## # A tibble: 500 × 6
##      pid   age   sex dx_dm dx_dyslip dx_lvh
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;lgl&gt; &lt;lgl&gt;     &lt;lgl&gt; 
##  1    11    52     1 TRUE  TRUE      TRUE  
##  2    15    57     2 TRUE  TRUE      TRUE  
##  3    20    62     1 TRUE  TRUE      TRUE  
##  4    24    69     2 TRUE  FALSE     TRUE  
##  5    33    70     2 TRUE  FALSE     TRUE  
##  6    37    64     2 FALSE TRUE      TRUE  
##  7    50    55     2 TRUE  NA        TRUE  
##  8    83    64     1 TRUE  FALSE     TRUE  
##  9    91    57     1 TRUE  FALSE     TRUE  
## 10   114    73     2 FALSE FALSE     TRUE  
## # … with 490 more rows</code></pre>
<p>Suppose we want to convert them to numeric with <code>as.numeric()</code>. This can be done using <code>where()</code> in the first argument of <code>across()</code> to identify all variables being of logical type, and <code>as.numeric</code> as the second argument:</p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="working-with-variables.html#cb236-1" aria-hidden="true" tabindex="-1"></a>diag <span class="sc">%&gt;%</span> </span>
<span id="cb236-2"><a href="working-with-variables.html#cb236-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.logical), as.numeric))</span></code></pre></div>
<pre><code>## # A tibble: 500 × 6
##      pid   age   sex dx_dm dx_dyslip dx_lvh
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt;
##  1    11    52     1     1         1      1
##  2    15    57     2     1         1      1
##  3    20    62     1     1         1      1
##  4    24    69     2     1         0      1
##  5    33    70     2     1         0      1
##  6    37    64     2     0         1      1
##  7    50    55     2     1        NA      1
##  8    83    64     1     1         0      1
##  9    91    57     1     1         0      1
## 10   114    73     2     0         0      1
## # … with 490 more rows</code></pre>
<p>If the operation we need to perform is complex and there is no single function to do it, we can use an expression preceeded by <code>~</code>, and use <code>.x</code> to indicate where the variable in across is used. For example, supose we want to recode all drug treatments as 1 or 0 instead of 1 or 2 (for yes or no, respectively). This will work:</p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="working-with-variables.html#cb238-1" aria-hidden="true" tabindex="-1"></a>treatments <span class="sc">%&gt;%</span> </span>
<span id="cb238-2"><a href="working-with-variables.html#cb238-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(bb<span class="sc">:</span>other, <span class="sc">~</span> <span class="fu">ifelse</span>(.x <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>)))</span></code></pre></div>
<pre><code>## # A tibble: 500 × 9
##      pid   lmr    bb  diur  acei   arb   cbb    ab other
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1    11     1     1     0     0     0     0     0     0
##  2    15     1     0     0     1     0     0     0     0
##  3    20     1     0     0     0     0     0     0     0
##  4    24     1     0     1     0     0     0     0     0
##  5    33     1     0     1     0     0     0     0     0
##  6    37     1     0     1     0     1     0     0     0
##  7    50     2     0     0     0     0     0     0     0
##  8    83     1     0     0     0     0     0     0     1
##  9    91     1     0     0     1     0     0     0     0
## 10   114     1     0     1     0     1     0     0     0
## # … with 490 more rows</code></pre>
</div>
</div>
<div id="resources-1" class="section level2 unnumbered hasAnchor">
<h2>Resources<a href="working-with-variables.html#resources-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li><p>For more on strings and <em>regex</em>, look at the vignettes of the <code>stringr</code> package. You may see them by running the following code in the R console:</p>
<ul>
<li><code>vignette("stringr")</code></li>
<li><code>vignette("regular-expressions")</code></li>
</ul></li>
<li><p>Of course, there is a <a href="https://evoldyn.gitlab.io/evomics-2018/ref-sheets/R_strings.pdf">stringr R cheat sheet</a>!</p></li>
<li><p>Try this nice <a href="https://regexone.com/">interactive tutorial</a> to practice your <em>regex</em>.</p></li>
<li><p>For a comparison of <code>stringr</code> and base R functions, see <a href="https://stringr.tidyverse.org/articles/from-base.html">here</a>.</p></li>
<li><p>Package <a href="https://cran.r-project.org/web/packages/translateR/translateR.pdf">translateR</a> provides easy access to the Google and Microsoft APIs for languaje detection and translation.</p></li>
<li><p>If you are interested in fuzzy matching of strings, look at the <a href="https://cran.r-project.org/web/packages/fuzzywuzzyR/vignettes/functionality_of_fuzzywuzzyR_package.html">fuzzywuzzyR</a> and <a href="https://github.com/markvanderloo/stringdist">stringdist</a> packages.</p></li>
<li><p>If you have ICD-9 or ICD-10 codes and need to compute comorbidity indices (such as the Charlson index), have a look to <a href="https://jackwasey.github.io/icd/">package <code>icd</code></a>.</p></li>
<li><p>For more on factors, look at the vignette of the <code>forcats</code> package by running the following code in the R console: <code>vignette("forcats")</code>, or see (this tutorial)[<a href="https://www.r-bloggers.com/2020/06/working-with-factors-in-r-tutorial-forcats-package/" class="uri">https://www.r-bloggers.com/2020/06/working-with-factors-in-r-tutorial-forcats-package/</a>].</p></li>
<li><p>For more on dates and times, see <a href="https://r4ds.had.co.nz/dates-and-times.html">this book chapter</a>, or <a href="https://www.r-bloggers.com/2020/04/a-comprehensive-introduction-to-handling-date-time-in-r/">this comprehensive tutorial</a>.</p></li>
</ul>
</div>
<div id="exercises-1" class="section level2 unnumbered hasAnchor">
<h2>Exercises<a href="working-with-variables.html#exercises-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ol style="list-style-type: decimal">
<li><p>From the following character vector of NYHA classes, use <code>str_extract()</code> with regular expressions to get two character vectors: one containing roman numerals only, and another one containing the text description, starting with a capital letter (the dots should be removed, as well any leading, trailing or extra white space).</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="working-with-variables.html#cb240-1" aria-hidden="true" tabindex="-1"></a>nyha <span class="ot">&lt;-</span>  <span class="fu">c</span>(<span class="st">&quot;I. no limitation&quot;</span>, </span>
<span id="cb240-2"><a href="working-with-variables.html#cb240-2" aria-hidden="true" tabindex="-1"></a>           <span class="st">&quot;II. mild symptoms &quot;</span>, </span>
<span id="cb240-3"><a href="working-with-variables.html#cb240-3" aria-hidden="true" tabindex="-1"></a>           <span class="st">&quot;III. Marked    symptoms&quot;</span>, </span>
<span id="cb240-4"><a href="working-with-variables.html#cb240-4" aria-hidden="true" tabindex="-1"></a>           <span class="st">&quot;IV.  severe limitations&quot;</span>)</span></code></pre></div></li>
<li><p>With the given vector on antecedents of four patients:</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="working-with-variables.html#cb241-1" aria-hidden="true" tabindex="-1"></a>antec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Asthma&quot;</span>, <span class="st">&quot;DM and AHT&quot;</span>, <span class="st">&quot;DM, AHT and pneumonia&quot;</span>, <span class="st">&quot;AHT + pneumonia&quot;</span>)</span></code></pre></div>
<ul>
<li>Use <code>str_view_all()</code> to test a regular expression detecting all separators between different antecedents of the same patient(<code>and</code>, <code>,</code> or <code>+</code>).</li>
<li>Use <code>str_replace_all()</code> to homogenize separators between antecedents using always <code>+</code> (e.g., “DM + AHT + pneumonia”).</li>
<li>From the vector you got in the previous question, can you compute a numeric vector showing the number of antecedents for each patient?</li>
</ul></li>
<li><p>Use the button to download a dataset on medical antecedents of 21 patients. After reading the data into dataframe <code>d</code>, run the code below to detect all diabetic patients, and then address the following tasks.</p>
<a onclick="fetch(&#39;data:application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;base64,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&#39;).then(res =&gt; res.blob()).then(blob =&gt; {&#10;      const downloadURL = window.URL.createObjectURL(blob);&#10;      const a = document.createElement(&#39;a&#39;);&#10;      document.body.appendChild(a);&#10;      a.href = downloadURL;&#10;      a.download = &#39;antecedents.xlsx&#39;; a.click();&#10;      window.URL.revokeObjectURL(downloadURL);&#10;      document.body.removeChild(a);&#10;    });">
<button class="btn btn-primary"><i class="fa fa-save"></i> Download antecedents data</button>
</a>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="working-with-variables.html#cb242-1" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>antecedent <span class="sc">%&gt;%</span> </span>
<span id="cb242-2"><a href="working-with-variables.html#cb242-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_to_lower</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb242-3"><a href="working-with-variables.html#cb242-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_view</span>(<span class="at">pattern =</span> <span class="st">&quot;diabet.s|diabetic|dm&quot;</span>)</span></code></pre></div>
<ul>
<li>Copy-paste the previous code and adapt the regexp in <code>pattern</code> to detect all patients with arterial hypertension.</li>
<li>Do the same to detect all patients with bronchial asthma.</li>
<li>Use the previous regexp patterns in <code>str_detect()</code> to create three new logical variables in dataframe <code>d</code>: <code>dm</code>, <code>aht</code>, and <code>ba</code>, as indicators of diabetes mellitus, arterial hypertension and bronchial asthma, respectively.</li>
</ul></li>
<li><p>Download the doses data set, read it, and produce the bar chart shown below.</p>
<a onclick="fetch(&#39;data:application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;base64,UEsDBBQABgAIAAAAIQBi7p1oXgEAAJAEAAATAAgCW0NvbnRlbnRfVHlwZXNdLnhtbCCiBAIooAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACslMtOwzAQRfdI/EPkLUrcskAINe2CxxIqUT7AxJPGqmNbnmlp/56J+xBCoRVqN7ESz9x7MvHNaLJubbaCiMa7UgyLgcjAVV4bNy/Fx+wlvxcZknJaWe+gFBtAMRlfX41mmwCYcbfDUjRE4UFKrBpoFRY+gOOd2sdWEd/GuQyqWqg5yNvB4E5W3hE4yqnTEOPRE9RqaSl7XvPjLUkEiyJ73BZ2XqVQIVhTKWJSuXL6l0u+cyi4M9VgYwLeMIaQvQ7dzt8Gu743Hk00GrKpivSqWsaQayu/fFx8er8ojov0UPq6NhVoXy1bnkCBIYLS2ABQa4u0Fq0ybs99xD8Vo0zL8MIg3fsl4RMcxN8bZLqej5BkThgibSzgpceeRE85NyqCfqfIybg4wE/tYxx8bqbRB+QERfj/FPYR6brzwEIQycAhJH2H7eDI6Tt77NDlW4Pu8ZbpfzL+BgAA//8DAFBLAwQUAAYACAAAACEAtVUwI/QAAABMAgAACwAIAl9yZWxzLy5yZWxzIKIEAiigAAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKySTU/DMAyG70j8h8j31d2QEEJLd0FIuyFUfoBJ3A+1jaMkG92/JxwQVBqDA0d/vX78ytvdPI3qyCH24jSsixIUOyO2d62Gl/pxdQcqJnKWRnGs4cQRdtX11faZR0p5KHa9jyqruKihS8nfI0bT8USxEM8uVxoJE6UchhY9mYFaxk1Z3mL4rgHVQlPtrYawtzeg6pPPm3/XlqbpDT+IOUzs0pkVyHNiZ9mufMhsIfX5GlVTaDlpsGKecjoieV9kbMDzRJu/E/18LU6cyFIiNBL4Ms9HxyWg9X9atDTxy515xDcJw6vI8MmCix+o3gEAAP//AwBQSwMEFAAGAAgAAAAhAKnD9hizAgAAMwYAAA8AAAB4bC93b3JrYm9vay54bWykVN9vmzAQfp+0/8HyOwWz/EQlFSHJFqnZonVtX5AqB5xgFWxmTJOq6v++M4S0aV66FiW2zwefv7v7zucXuzxDD0yVXAofkzMHIyZimXCx8fH1n5k1wKjUVCQ0k4L5+JGV+GL09cv5Vqr7lZT3CABE6eNU68Kz7TJOWU7LM1kwAZ61VDnVYKqNXRaK0aRMGdN5ZruO07NzygVuEDz1Hgy5XvOYTWRc5UzoBkSxjGqgX6a8KFu0PH4PXE7VfVVYscwLgFjxjOvHGhSjPPbmGyEVXWUQ9o500U7Brwd/4sDgtieB6+SonMdKlnKtzwDabkifxE8cm5CjFOxOc/A+pI6t2AM3NTywUr0PsuodsHovYMT5NBoBadVa8SB5H0TrHri5eHS+5hm7aaSLaFH8pLmpVIZRRks9TbhmiY/7YMotO9pQVTGueAZetzNw+9geHeS8VGBA7YNMMyWoZqEUGqS2p/5ZWdXYYSpBxOg3+1txxaB3QEIQDow09uiqXFKdokplPg696LqECCMay5WMWt2X0WL6PYiCMDRb0K+cRuGvxdhC89mCXyLBtmgShFeR46IJ1RQtqKAbZlomSsCOXmmXnjbKf6iXxiZ5NiSsCapZv00exKa8VqFLrRCs55NLqNIVfYCagTKSfUvPoSjk252IlUfuntyQhO542LFm037H6gTDwBrPSMca9KfdaTgJgmFv+AzBqJ4XS1rpdC8HA+3jDtT+xLWgu9ZDHK/iyQuNJ2f/WGZ+M7S+ZxOwufhuONuWL8IxJtrdcpHIrY8t4kJQj8fmtnbe8kSnoLyh04FXmr0fjG9SYEy6A7MJDWKY+fiI0aRhNIPHMsMRI/sVpfqKBWr1jETdFlfm2kUELnOzqLOMkfLMIWqekLqK7XcxzeKlQmYyLzq1s73vR/8AAAD//wMAUEsDBBQABgAIAAAAIQCBPpSX8wAAALoCAAAaAAgBeGwvX3JlbHMvd29ya2Jvb2sueG1sLnJlbHMgogQBKKAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACsUk1LxDAQvQv+hzB3m3YVEdl0LyLsVesPCMm0KdsmITN+9N8bKrpdWNZLLwNvhnnvzcd29zUO4gMT9cErqIoSBHoTbO87BW/N880DCGLtrR6CRwUTEuzq66vtCw6acxO5PpLILJ4UOOb4KCUZh6OmIkT0udKGNGrOMHUyanPQHcpNWd7LtOSA+oRT7K2CtLe3IJopZuX/uUPb9gafgnkf0fMZCUk8DXkA0ejUISv4wUX2CPK8/GZNec5rwaP6DOUcq0seqjU9fIZ0IIfIRx9/KZJz5aKZu1Xv4XRC+8opv9vyLMv072bkycfV3wAAAP//AwBQSwMEFAAGAAgAAAAhAOTIuNN3CQAAPj0AABgAAAB4bC93b3Jrc2hlZXRzL3NoZWV0MS54bWyckktv2zAMx+8D9h0E3WNZzmOtEafYWhQrsMOwrd1ZkelYiB6epLww7LuXVuakQC5BDVuWRPL3JyXO7/ZGky34oJytKM9ySsBKVyu7qujzr8fRDSUhClsL7SxU9ACB3i0+fpjvnF+HFiASJNhQ0TbGrmQsyBaMCJnrwKKlcd6IiEu/YqHzIOoUZDQr8nzGjFCWHgmlv4bhmkZJeHByY8DGI8SDFhHzD63qwkAz8hqcEX696UbSmQ4RS6VVPCQoJUaWTyvrvFhqrHvPJ0KSvce3wG88yKT9CyWjpHfBNTFDMjvmfFn+LbtlQp5Il/VfheET5mGr+gs8o4r3pcSnJ1Zxho3fCZudYP1x+XKj6or+zf8/I/zzfsjPw2D7RxfzWuEN91URD01FP/PyCx/PKFvMUwe9KNiFN3MSxfInaJARUIVTEl33DZp4D1r30fmMkr5nl86t+9gn9MpRJqSYXkbIqLZw9EcpPIDwJ0mnBeqyk/Db+ZDEY+r0757U0IiNjvdO/1Z1bDEZnk2K6acbXkzpYP3hdl9BrdqIZtxNbVTWhwcIEvsaU8vQmS1eAQAA//8AAAD//5Sba27kRgyEr2L4ALGotxbeAbLYixiOgfzaBDuGN7l9iqSsBzsNqv4lHKLKbLU+tWZqn+9/vr29f395f7k9//zr18PPr4/y+HD/++XHHf/1pX18+Ef6l9cvf/z7/e3++vbj/etj81s7PN6eX7X3dzSjdMf/f9ya56eP2/PT6/rZt+Nnsn32BJvNC/rXvVpz2ZXsL/gGie0vaP/fpWNcOnPZldwFEplLz7j05tKFFYNE5jIwLnqdPm59cIHE5rL/BafrMjIuo7kMwQUS2SwT4zKZyxhcIJG5zIzLbC5TcIHE5rJ/dlqxhXFZzGUOLpDIZpGGujkb81nifQmR1IijgPitWRDgiIB9G54WTigGoFu3tEQKqEo6E8UBcRBIJAHqu1NtJooF4jCQSAPU0xtVKB6g21YvEkFVttXbt+X5OlFMEIeCRCqgvjvtG/PsRHFBHAwSyYB6viMoNojDQSIdUN+dZL8HzkNRgBAnhEREoL5b7Wt7fqZSjGidERIhgfrutK/t2YmCROuQaCMkUD8sX+2gwJ0UnBJtcVY4UqJy77YUJdCtd1QbKaEq2x1VWz6KEq1Too2UQD3d5ziwMecsp0QbKaEq6UwUJVqnRBspgXpKvpaiBLrtOkVKqMo204H1531OYaJ1TLQRE6jny0dRonVKtJESqKeU6ChKoNuWL1JCVdLTN0WJzinRRUqgnjtRkOgcEl2EBOr56nGvFA6JrnipOEKichLvKEigW69TFyGhKul1oiDROSS6CAnU01u3oyCBbpspQkJVsveYjoIEus0pQkJV0tWjGNE5I7rICNTzmShGdM6ILjIC9XSmnmIEum31IiNUZVu9ypmlpxiBbnuvjYxQlR3mlRuqpyCBbrOKkFCV7FnYU5BAtzlFSKhKtvl67rsHh0RffPtwhETtQlGQ6NcvICIkUM+3BAWJ3iHRR0ignjtRkOgdEn2EBOr5daIg0Tsk+ggJ1HMnChK9Q6KPkED9cENVDswDRQl02zaPlFCVbJsPFCXQrU5DpISqpE4UJAaHxBAhgXoKiYGCBLptpggJVckYO1CQQLc5RUioSurEfUnpkBiKrykvvG4MFCTQbTNFSKhKdpIYKEig25wiJFQl3XsUJAaHxBAhgXruREFicEgMERKopztipBiBblu9yAhVyR66I8UIdKvTGBmhKtmOGClGoNucIiNUJXWiGDE6I8bICNTTHTFSjEC3zRQZoSrZLh8pRqDbnCIjVCVdPe7HDGfEWPycceH3jJFiBLptpsgIVdlPsZVz2EhBAt1mFSGhKptV5fE+UpBAtzlFSKhK5jRRkEC3OUVIqErqREFickhMERKop9t8oiCBbp1pipBQlQx8EwUJdJtThISqpE4UJCaHxBQhgXr62JgoSKDbZoqQUJV0JgoSk0NiipBAPd8R3K+eDomp+N3zwkFiohiBblu9yAhVSe8nihGTM2KKjEA9hflMMQLdNlNkhKpkj42ZYgS61WmOjFCVbO/NFCPQbU6REaqyOVWeGjPFCHSbU2SEqmSP95liBLrNKTJCVdLVoxgxOyPmyAjUcyeKEbMzYo6MQD13ohgxOyPmyAjUcycuHeGMmIt8xIWXjZliBLptR0RGqEq29xaKEeg2p8gIVUmdKEYszoglMgL1lEYLxQh060xLZISqpDNRjFicEUtkBOrp3lsoRqDbZoqMUJV0JooRizNiiYxAPZ+JYsTijFgiI1DPZ6IYsTgjlsgI1HMnihGLM2KJjEA93+UUIxZnxFLkqI6MqPz2Lg0FCW233VdmqS5gQhqKE9quZjAtklsXjhPSUKzQdncrMlUqlN1a0lC80HZ3K3JVKpQ97KWhmKHt7lZkq1QoOy5JQ3FD292tyFepUD4bxQ5p1ohVU2Ss8MkFN4of0qwxq6bIWeGTC24UQ6RZo1ZNkbXCJylGpKE4ou1+3Yq4lQplLwpChjLR7m4FS1Qo3SXCsQTt5nbIpXmiWVQod+NYssUzC5ZcCmhqtpLInn9GNMuM5imkWUmFi+YrGbeVJWVO8xTUrLpxLPmMakrBklNYs/Ijt2jOkpltZUmZ1zwFNmsPU81aMm4rS8rM5qXQpuYtGbeVJWVu8xTcrM7GseQzuVlGN0/ZzcPoIQ3NnUs+45tFflNOAc5q9pqDyRrhhHY8mJxCnLVboOVggnZDVxHjFBVKscwFOWVNckK7mO3C9x2iMUxiU65pTrgWbseDSe325gKdYv9gBwfKItKpn1xYSQ4ma6oT2sVsF9IYwgU7td13SXEwOWU7qyvJwWQNd8K1mO3C96SiyUxml6wHkyLhaULbHXAg2xkmXMhT1pQnxONwp5xnDSYa0SSGW5OecC3cLvywIhrTZNxWmBRxTxNK33I67mSCdtuUReRTVCh97+BCn7KmPqFdrOSVtxyNbDIrub7lFNFPOWU/K19BCxf+1HZfyQImp/xnfOQ87f+u8T8AAAD//wAAAP//TIxBCsJADEWvEnIAO1BEhE5Xbl31BKOmnWBtQpoq9PROhYK7/96H12ga6Jps4GmGkXqPGA4nBOMh79tFf/aIcBN3ee2UKT3INqoRehHfoWqbrduRLwqalKzjlSKeEcSYJk/OMkVUMbfEjpCLX6Uc40U5Yh0CwpvM+f5nSrb6iD3nTOTtFwAA//8DAFBLAwQUAAYACAAAACEAIdtPR/UFAAAlGgAAEwAAAHhsL3RoZW1lL3RoZW1lMS54bWzsWd1z2jgQf7+Z+x80fm8DCdCQKekEAu1NmjaT0N70cbGFrSJbHkkk5b+/lWRACqJJ2szcV3lIsPzTfu9qV7x+863k5JZKxUQ1SNovWwmhVSoyVuWD5NN08uI4IUpDlQEXFR0kK6qSN6e///YaTnRBS0pwf6VOYJAUWtcnBwcqxWVQL0VNK3w3F7IEjY8yP8gk3CHdkh8ctlq9gxJYlZAKSiT7cT5nKSVTQzI5XRMfc3ystDILKZc3hjQNdlhstmgbhFqpEZfkFvggQT6ZuJvSbzohHJTGF4OkZT/JwenrAzhpNnG9Z6+3b2I/zb5mQ7Y4tDxlPtswbU86/VfnG/oWwPUubjwej8btDT0LgDRFTZ0sPs3O5Lg9XNP0QO7rLu1Rq9vqhHiP/tGOzP3hcNjtN7I4ohbkvnZ28MetXufsMMBbkMN3d/Cd4dlo1AvwFuTwvR385FW/1wnxFlRwVi120Mahk0lDfQOZC/4uCj9G+HGrgW9RGA2b6DIs5qLS+2KthK9CThBggBw0q4he1XQOKUbxCMqZZGAYwAkF741bStXOkuFFVCpZrQfJmYRZ4kGmrKSKfKB35FqUUDkiwY53dCaftmNaAAt2QIG0I6THugiAH1bAY7ghrXKf4GeJuRcDvl1+DWS9KeRSswjni6IMgJdC8KGQUQNcGF6+yZZVHmculz7uGuA2xnsElfJx42WNRWft08D2o4IGYl5xqDTktKKamHdiQWlEuy+MBXa9ZKkUSsw1+cLIEFjUJFM2w0q2jbTtpnesRL+sYjqjqwPbXH4mQ8FjWp/T2xAJaEUeEX5KeWDGt7DUUMZITqHkvsTvQRcxIW9WMg0MrjR6OqdckHFGlYrt+ShRX88aF4DpHnX7JV+VIVJqtojRfA9C+MhzsRgVUNZRmVlV+Ng/1AJDFMiV0DH4pQgzxDyjH6Da6+7PjAbufrgQfGJ5INI2QMybpYz48i0VYT6u+ByorTJYEYNCV7Lqe1WPMyx7z1b1zrCExmLvfq3bh/sXVrhzWFZXFIPKnhxBlflV4H4VuOQ/X+D25fLzl7VtJcMit+30bN9X7m375ozzG73i9L2ynZ/C+p1NcNG2pHYu2YwBdYFfmyYzwOUS7B4ihf6T6eKmgBq7xrYdYnLVkM4VqYXCacUu23GK3qNtBySGjaOddbqmC3aVQ4G+FJlbPvKnnQ0ZO/vkdqJaMzoyBB7L7OjVzzFrO6n2mi1UrW1Fs0UxUG2jMvpwVzVc3FgTGwOC7QRauYdDp5Edu23gNDN2d5Pg2i2G9bO6SBWQ0cZHRu9dH7Wtk9axsg6jiI/M5PKAjzxufUP2J7g9xkk+u84edmvv/YyX1uPa1ksmb++lI6/85OQVuRsk/e5hNyEp1INkjoMafi1r9LoyvRjwHG87Ui1d2D+YzDZct97sx8OyjbO3s/uOwkEdqKXS56AKFxr2VRMCvLJjpZX/sItmfS4FXKT/gBRHxxgMf5sUaMfQtXQ+p6n2ne2t2KnbAppSKpaaypsiuyMzvpTXgO43oYr6ZEzhvG0rgnnAyyFjbfsqLM5N0vlXMhbn1oHXBTTl1qToOpMd3ObxRgb75KS14qFuUdmtck9Xxab8M6nih/H/TBVznuAEf5QZD6R4NymBmHwdJELqQmAVqguWTiRe29jagdGCF4z4GoMKb0jtf0lvzX+Xc46GTWscxPQ1y4lkeB7pQlJ6hWXJRt8DxNrN2eVI8oaQjShPXFU7sWf0lvKpqYE9c7YnpMBQt9WkKQMWdz/+wucmg2a5aXL+qZ2PS+antgemO3Atltv/yF6k4xV97yjoR88+21NtysF3DvYnHrWuYu1ofNh99FFb4z0MMX/w/GMy5e663RyoU3GNtZXg7blrrwhG9QvXeBBTIF15nGHj5BZdMBlSrmFputtnb6PwjrXpdDd8MUt/pNN9orE3zVnILsjF73efTzN2Y+HA1n6nGzE1Ju39FDXt0XqQsY6xv9P4P6WI2Vd09DleWi+5Vu6y+hveuuGU4a69Mfmdc+3W078AAAD//wMAUEsDBBQABgAIAAAAIQAJE8rvqQIAAFcGAAANAAAAeGwvc3R5bGVzLnhtbKRVXWvbMBR9H+w/CL27st04S4LtsjQ1FLoxaAd7lW3ZEdVHkJTM2dh/35WdD4eObbR5iKSrq3PPvedKTm86KdCOGcu1ynB0FWLEVKVrrtoMf30qghlG1lFVU6EVy/CeWXyTv3+XWrcX7HHNmEMAoWyG185tFoTYas0ktVd6wxTsNNpI6mBpWmI3htHa+kNSkDgMp0RSrvCAsJDV/4BIap63m6DSckMdL7ngbt9jYSSrxX2rtKGlAKpdNKEV6qKpiVFnjkF664s4kldGW924K8Aluml4xV7SnZM5odUZCZBfhxQlJIwvcu/MK5EmxLAd9/LhPG20chZVeqsciAlEfQkWz0p/V4Xf8sbBK0/tD7SjAiwRJnlaaaENMm2Z4aII+583KyrZ4HZLBS8N98aGSi72gzn2hl7yg5/kIIA3Ek/mMFg4xIU4UYs9CzDkKWjomFEFLNBh/rTfgHoK2m2A6f3+4d0auo/iZHSA9AHztNSmhvY+F+VoylPBGgdEDW/XfnR6A/+ldg5aIE9rTlutqPCpDCCnCaRTMSEe/RX41lxgdw1SW1lId19nGC6TL8JxCokcpgPesPD4Y7QB+82wqGsu8QFxRPuC9Ck88npn+LO/swLa5wCByi0Xjqs/EAbMujuXIPQKOH//+uKcokAlatbQrXBPp80Mn+efWM23Mj55feE77XqIDJ/nD16paOpjsM49WGgvGNHW8Az/vFt+mK/uijiYhctZMLlmSTBPlqsgmdwuV6tiHsbh7a/RK/CGN6B/tPIUbtfCCngpzCHZQ4qPZ1uGR4uBft+jQHvMfR5Pw49JFAbFdRgFkymdBbPpdRIUSRSvppPlXVIkI+7JK9+KkETR8Op48snCcckEV0etjgqNrSASLP+SBDkqQc5fhPw3AAAA//8DAFBLAwQUAAYACAAAACEAFSeyuwkBAACYAgAAFAAAAHhsL3NoYXJlZFN0cmluZ3MueG1sdJLBbsMgDIbvk/YOFvcVkq1bVRF6mLSdetseAAU3QQqQYVKtbz/S7pTQI7/t/7c/IQ+/boAzRrLBN6zaCAbo22Cs7xr2/fXxtGNASXujh+CxYRckdlCPD5IoQZ711LA+pXHPObU9Ok2bMKLPlVOITqf8jB2nMaI21CMmN/BaiFfutPUM2jD5lHOf3xhM3v5M+P6v7JiSZJVMarRG8qQkn583yQTCpVYJAa5bqtuSWG8LnXmrgloVDeas4yprdjh+lvZaG8/s9jTqNjPNcAjjGZkCKMWVe2/3AqzyrhbAoX7pizSAG30pV4y2w6p0BWMH20XtaDF354witTu9S+48/yz1BwAA//8DAFBLAwQUAAYACAAAACEABeSPJkkBAABiAgAAEQAIAWRvY1Byb3BzL2NvcmUueG1sIKIEASigAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAjJJPS8MwGIfvgt+h5N4m7diU0HboZCcHghPFW5a824rNH5Jot29v2m61Qw8ek98vT568JJ8fZB19gXWVVgVKE4IiUFyLSu0K9LJexrcocp4pwWqtoEBHcGheXl/l3FCuLTxZbcD6ClwUSMpRbgq0995QjB3fg2QuCQ0Vwq22kvmwtDtsGP9gO8AZITMswTPBPMMtMDYDEZ2Qgg9I82nrDiA4hhokKO9wmqT4p+vBSvfngS4ZNWXljya86aQ7Zgveh0P74Kqh2DRN0kw6jeCf4rfV43P31LhS7aw4oDIXnHILzGtbMq43OsejnXZ6NXN+FQa9rUDcH8u7ehPmGC1C1eX4dx6AnX9PBREFI9r7n5PXyeJhvURlRrIsJlmcTdfpDSWEpuS9vf7ifGvYb8iTxD+JM0pSOr0ZEc+AsvO+/BXlNwAAAP//AwBQSwMEFAAGAAgAAAAhAAmFT45+AQAA/wIAABAACAFkb2NQcm9wcy9hcHAueG1sIKIEASigAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAnJLLTsMwEEX3SPxD5D11CgihyjFCPMQCRKUWWBtn0li4duQZopavZ5KIkgIrdvO4uj6+trrYrH3WQkIXQyGmk1xkEGwsXVgV4ml5e3QuMiQTSuNjgEJsAcWFPjxQ8xQbSOQAM7YIWIiaqJlJibaGtcEJrwNvqpjWhrhNKxmrylm4jvZ9DYHkcZ6fSdgQhBLKo2ZnKAbHWUv/NS2j7fjwebltGFiry6bxzhriW+oHZ1PEWFF2s7HglRwvFdMtwL4nR1udKzlu1cIaD1dsrCvjEZT8Hqg7MF1oc+MSatXSrAVLMWXoPji2Y5G9GoQOpxCtSc4EYqxONjR97RukpF9iesMagFBJFgzDvhxrx7U71dNewMW+sDMYQHixj7h05AEfq7lJ9AfxdEzcMwy8A86i48uGQ8eA/Z35qB/m9y684VOzjNeG4Cu8/aFa1CZByXnvwt0N1B3nlnxnclWbsILyS/N70T318/Cf9fRskp/k/IqjmZLfP1d/AgAA//8DAFBLAQItABQABgAIAAAAIQBi7p1oXgEAAJAEAAATAAAAAAAAAAAAAAAAAAAAAABbQ29udGVudF9UeXBlc10ueG1sUEsBAi0AFAAGAAgAAAAhALVVMCP0AAAATAIAAAsAAAAAAAAAAAAAAAAAlwMAAF9yZWxzLy5yZWxzUEsBAi0AFAAGAAgAAAAhAKnD9hizAgAAMwYAAA8AAAAAAAAAAAAAAAAAvAYAAHhsL3dvcmtib29rLnhtbFBLAQItABQABgAIAAAAIQCBPpSX8wAAALoCAAAaAAAAAAAAAAAAAAAAAJwJAAB4bC9fcmVscy93b3JrYm9vay54bWwucmVsc1BLAQItABQABgAIAAAAIQDkyLjTdwkAAD49AAAYAAAAAAAAAAAAAAAAAM8LAAB4bC93b3Jrc2hlZXRzL3NoZWV0MS54bWxQSwECLQAUAAYACAAAACEAIdtPR/UFAAAlGgAAEwAAAAAAAAAAAAAAAAB8FQAAeGwvdGhlbWUvdGhlbWUxLnhtbFBLAQItABQABgAIAAAAIQAJE8rvqQIAAFcGAAANAAAAAAAAAAAAAAAAAKIbAAB4bC9zdHlsZXMueG1sUEsBAi0AFAAGAAgAAAAhABUnsrsJAQAAmAIAABQAAAAAAAAAAAAAAAAAdh4AAHhsL3NoYXJlZFN0cmluZ3MueG1sUEsBAi0AFAAGAAgAAAAhAAXkjyZJAQAAYgIAABEAAAAAAAAAAAAAAAAAsR8AAGRvY1Byb3BzL2NvcmUueG1sUEsBAi0AFAAGAAgAAAAhAAmFT45+AQAA/wIAABAAAAAAAAAAAAAAAAAAMSIAAGRvY1Byb3BzL2FwcC54bWxQSwUGAAAAAAoACgCAAgAA5SQAAAAA&#39;).then(res =&gt; res.blob()).then(blob =&gt; {&#10;      const downloadURL = window.URL.createObjectURL(blob);&#10;      const a = document.createElement(&#39;a&#39;);&#10;      document.body.appendChild(a);&#10;      a.href = downloadURL;&#10;      a.download = &#39;doses.xlsx&#39;; a.click();&#10;      window.URL.revokeObjectURL(downloadURL);&#10;      document.body.removeChild(a);&#10;    });">
<button class="btn btn-primary"><i class="fa fa-save"></i> Download doses data</button>
</a>
<p><img src="_main_files/figure-html/unnamed-chunk-87-1.png" width="672" style="display: block; margin: auto;" /></p></li>
<li><p>On the same data, use <code>fct_collapse()</code> to define doses as “low” (25 or 50 mg), “medium” (100 mg) or “high” (150 or 200 mg), and produce the following bar chart:</p>
<p><img src="_main_files/figure-html/unnamed-chunk-88-1.png" width="672" style="display: block; margin: auto;" /></p></li>
<li><p>The following code reads the DISETAHE study data, selects drug class variables, verticalises them, and filters patients that took each drug class. From the resulting dataframe <code>drug_classes</code>, reproduce the bar chart shown below (with identical descriptors for drug classes).</p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="working-with-variables.html#cb243-1" aria-hidden="true" tabindex="-1"></a>drug_classes <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">&quot;./data/hta.xlsx&quot;</span>, <span class="at">sheet =</span> <span class="st">&quot;data&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb243-2"><a href="working-with-variables.html#cb243-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(pid, bb<span class="sc">:</span>other) <span class="sc">%&gt;%</span> </span>
<span id="cb243-3"><a href="working-with-variables.html#cb243-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(bb<span class="sc">:</span>other, <span class="at">names_to =</span> <span class="st">&quot;drug_class&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb243-4"><a href="working-with-variables.html#cb243-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(value <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb243-5"><a href="working-with-variables.html#cb243-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(pid, drug_class) </span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-90-1.png" width="672" style="display: block; margin: auto;" /></p></li>
<li><p>Create a dataframe with the CIP codes provided below, and use a <code>mutate()</code> statement to compute additional variables <code>sex</code>, <code>dob</code> and <code>age</code>:</p>
<ul>
<li><code>cip</code> = the CIP code.</li>
<li><code>sex</code> = a factor with labels “male” and “female”.</li>
<li><code>dob</code> = the date of birth; this should be a <code>Date</code> object.</li>
<li><code>age</code> = the patient’s age as of 2022-01-01.</li>
</ul>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb244-1"><a href="working-with-variables.html#cb244-1" aria-hidden="true" tabindex="-1"></a>cip <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;FEGA0720525000&quot;</span>, <span class="st">&quot;ROMA1690913000&quot;</span>, <span class="st">&quot;PEJI0010503&quot;</span>)</span></code></pre></div></li>
<li><p>Repeat the previous exercise after adding this new CIP to the <code>cip</code> vector: “ALCO0580325000”.</p></li>
<li><p>The date of enrollment of a patient in a study was “2016-01-01”. In this study, follow-up visits should be conducted at 1, 3 and 6 months and 1 year after enrollment, and yearly thereafter up to 5 years.</p>
<ul>
<li>What should be the dates of follow-up visits assuming 30-day months?<br />
</li>
<li>And what would they be using natural month intervals?<br />
</li>
<li>Is there any saturday or sunday among them?</li>
</ul></li>
<li><p>Use <code>across()</code> in a <code>mutate()</code> statement to recode all yes/no variables in the DISETAHE dataset so that they take values 1 (for yes) or 0 (for no).</p></li>
</ol>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="working-with-dataframes.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="data-validation.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
